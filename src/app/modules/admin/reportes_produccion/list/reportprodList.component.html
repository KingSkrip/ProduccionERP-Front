<div class="absolute inset-0 flex flex-col min-w-0 overflow-hidden">

    <!-- Header -->
    <div
        class="relative flex flex-col sm:flex-row flex-0 sm:items-center sm:justify-between py-4 sm:py-8 px-4 sm:px-6 md:px-8 border-b dark:bg-transparent">
        <!-- Title -->
        <div class="text-2xl sm:text-3xl md:text-4xl font-extrabold tracking-tight leading-none">
            Reportes de producción
        </div>
    </div>

    <!-- FILTROS COMPLETO PARA MÓVIL (md:hidden) -->
    <div class="md:hidden">
        <!-- Barra superior fija: Búsqueda + Botón Filtros -->
        <div
            class="sticky top-0 z-40 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 shadow-sm">
            <div class="flex items-center gap-3 p-4">
                <!-- Campo de búsqueda -->
                <mat-form-field class="fuse-mat-dense fuse-mat-rounded-lg flex-1" appearance="outline"
                    [subscriptSizing]="'dynamic'">
                    <mat-icon matPrefix class="text-gray-500" [svgIcon]="'heroicons_solid:magnifying-glass'"></mat-icon>
                    <input matInput [formControl]="searchControl" [autocomplete]="'off'" placeholder="Buscar...">
                </mat-form-field>

                <!-- Botón de filtros con badge -->
                <button mat-icon-button color="primary" class="relative" (click)="togglePanelFiltros()"
                    [matBadge]="filtrosActivosCount()" matBadgeSize="small" matBadgeColor="accent"
                    [matBadgeHidden]="filtrosActivosCount() === 0">
                    <mat-icon class="w-6 h-6" [svgIcon]="'heroicons_solid:adjustments-horizontal'"></mat-icon>
                </button>
            </div>
        </div>

        <!-- Panel completo de filtros (modal full-screen en móvil) -->
        <div *ngIf="mostrarPanelFiltros"
            class="fixed inset-0 z-50 flex flex-col bg-white dark:bg-gray-900 transition-all duration-300 ease-out">

            <!-- Header premium -->
            <div class="flex items-center justify-between p-5 border-b border-gray-200 dark:border-gray-700 
                    sticky top-0 bg-white dark:bg-gray-900 z-10 shadow-sm">
                <h2 class="text-xl font-bold">Filtros avanzados</h2>
                <button mat-icon-button class="text-gray-500 hover:text-gray-700" (click)="togglePanelFiltros()">
                    <mat-icon class="w-6 h-6" [svgIcon]="'heroicons_solid:x-mark'"></mat-icon>
                </button>
            </div>

            <!-- Contenido scrollable -->
            <div class="flex-1 overflow-y-auto p-5 space-y-8">

                <!-- 1. Filtro de Fechas - Botón principal -->
                <div class="relative">
                    <button mat-stroked-button class="w-full h-14 px-5 justify-between rounded-xl border-2 
                               hover:border-primary-500 transition-all duration-200 font-medium text-base
                               bg-white dark:bg-gray-800" (click)="toggleDatePanel()">
                        <div class="flex items-center gap-3">
                            <mat-icon class="icon-size-6 text-primary"
                                [svgIcon]="'heroicons_solid:calendar-days'"></mat-icon>
                            <span class="truncate font-medium">{{ obtenerTextoFechaSeleccionada() || 'Seleccionar
                                fechas' }}</span>
                        </div>
                        <mat-icon [svgIcon]="'heroicons_solid:chevron-down'"
                            class="text-gray-500 transition-transform duration-200"
                            [ngClass]="{'rotate-180': mostrarPanelFechas}"></mat-icon>
                    </button>

                    <!-- Panel desplegable de fechas (estilo premium) -->
                    <div *ngIf="mostrarPanelFechas" class="absolute top-full left-0 right-0 mt-3 bg-white dark:bg-gray-800
                            rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700 
                            z-50 overflow-hidden flex flex-col ring-4 ring-primary-500/10">

                        <!-- Header del panel fechas -->
                        <div class="sticky top-0 bg-white dark:bg-gray-800
                                p-5 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <mat-icon class="icon-size-6 text-primary"
                                        [svgIcon]="'heroicons_solid:calendar-days'"></mat-icon>
                                    <h3 class="text-lg font-bold">Filtrar por fechas</h3>
                                </div>
                                <div class="flex items-center gap-3">
                                    <button mat-button color="primary" class="font-medium"
                                        (click)="limpiarFiltroFechas()">
                                        Limpiar
                                    </button>
                                    <button mat-icon-button (click)="toggleDatePanel()">
                                        <mat-icon [svgIcon]="'heroicons_solid:x-mark'"></mat-icon>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Opciones rápidas -->
                        <div class="p-5 space-y-5">
                            <div class="grid grid-cols-2 gap-4">
                                <button mat-flat-button class="h-12 rounded-xl  justify-between col-span-2
           border-2 transition-all" [ngClass]="{
        'bg-primary border-primary text-white': rangoFechaSeleccionado === 'todos',
        'bg-white border-gray-400 text-black dark:bg-gray-800 dark:text-white': rangoFechaSeleccionado !== 'todos'
    }" (click)="seleccionarRangoFecha('todos')">

                                    <span>Ver todos</span>
                                    <mat-icon *ngIf="rangoFechaSeleccionado === 'todos'"
                                        [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                </button>


                                <button mat-flat-button class="h-12 rounded-xl font-medium justify-between
           border-2 transition-all" [ngClass]="{
        'bg-primary border-primary text-white': rangoFechaSeleccionado === 'hoy',
        'bg-white border-gray-400 text-black dark:bg-gray-800 dark:text-white': rangoFechaSeleccionado !== 'hoy'
    }" (click)="seleccionarRangoFecha('hoy')">
                                    Hoy
                                    <mat-icon *ngIf="rangoFechaSeleccionado === 'hoy'"
                                        [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                </button>

                                <button mat-flat-button class="h-12 rounded-xl font-medium justify-between
           border-2 transition-all" [ngClass]="{
        'bg-primary border-primary text-white': rangoFechaSeleccionado === 'ayer',
        'bg-white border-gray-400 text-black dark:bg-gray-800 dark:text-white': rangoFechaSeleccionado !== 'ayer'
    }" (click)="seleccionarRangoFecha('ayer')">
                                    Ayer
                                    <mat-icon *ngIf="rangoFechaSeleccionado === 'ayer'"
                                        [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                </button>

                                <button mat-flat-button class="h-12 rounded-xl font-medium justify-between
           border-2 transition-all" [ngClass]="{
        'bg-primary border-primary text-white': rangoFechaSeleccionado === 'mes_actual',
        'bg-white border-gray-400 text-black dark:bg-gray-800 dark:text-white': rangoFechaSeleccionado !== 'mes_actual'
    }" (click)="seleccionarRangoFecha('mes_actual')">
                                    Mes actual
                                    <mat-icon *ngIf="rangoFechaSeleccionado === 'mes_actual'"
                                        [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                </button>

                                <button mat-flat-button class="h-12 rounded-xl font-medium justify-between
           border-2 transition-all" [ngClass]="{
        'bg-primary border-primary text-white': rangoFechaSeleccionado === 'mes_anterior',
        'bg-white border-gray-400 text-black dark:bg-gray-800 dark:text-white': rangoFechaSeleccionado !== 'mes_anterior'
    }" (click)="seleccionarRangoFecha('mes_anterior')">
                                    Mes anterior
                                    <mat-icon *ngIf="rangoFechaSeleccionado === 'mes_anterior'"
                                        [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                </button>


                                <button mat-stroked-button class="h-12 rounded-xl col-span-1 font-medium
           border-2 transition-all" [ngClass]="{
        'border-primary text-primary bg-primary/10': rangoFechaSeleccionado === 'fecha_especifica',
        'border-gray-400 text-black dark:text-white': rangoFechaSeleccionado !== 'fecha_especifica'
    }" (click)="seleccionarRangoFecha('fecha_especifica')">
                                    Fecha específica
                                </button>

                                <button mat-stroked-button class="h-12 rounded-xl col-span-1 font-medium
           border-2 transition-all" [ngClass]="{
        'border-primary text-primary bg-primary/10': rangoFechaSeleccionado === 'periodo',
        'border-gray-400 text-black dark:text-white': rangoFechaSeleccionado !== 'periodo'
    }" (click)="seleccionarRangoFecha('periodo')">
                                    Periodo personalizado
                                </button>

                            </div>

                            <!-- RANGO PERSONALIZADO (exacto como tu imagen) -->
                            <div *ngIf="rangoFechaSeleccionado === 'periodo'" class="pt-6 space-y-5">
                                <h4 class="text-lg font-semibold text-primary">Rango personalizado</h4>

                                <!-- Fecha Desde -->
                                <div>
                                    <label class="block text-sm font-medium text-primary mb-2">Fecha Desde</label>
                                    <mat-form-field class="w-full fuse-mat-dense fuse-mat-rounded-lg"
                                        appearance="outline">
                                        <input matInput [matDatepicker]="pickerInicio"
                                            [formControl]="fechaInicioControl" placeholder="12/17/2025">
                                        <mat-datepicker-toggle matIconSuffix
                                            [for]="pickerInicio"></mat-datepicker-toggle>
                                        <mat-datepicker #pickerInicio touchUi></mat-datepicker>
                                    </mat-form-field>
                                </div>

                                <!-- Fecha Hasta -->
                                <div>
                                    <label class="block text-sm font-medium text-primary mb-2">Fecha Hasta</label>
                                    <mat-form-field class="w-full fuse-mat-dense fuse-mat-rounded-lg"
                                        appearance="outline">
                                        <input matInput [matDatepicker]="pickerFin" [formControl]="fechaFinControl"
                                            placeholder="12/17/2025">
                                        <mat-datepicker-toggle matIconSuffix [for]="pickerFin"></mat-datepicker-toggle>
                                        <mat-datepicker #pickerFin touchUi></mat-datepicker>
                                    </mat-form-field>
                                </div>

                                <!-- Botón Aplicar (verde redondeado como en tu imagen) -->
                                <button mat-flat-button color="primary"
                                    class="w-full h-14 rounded-full font-bold text-lg shadow-lg text-white dark:text-white"
                                    (click)="aplicarFiltroFechas()">
                                    <mat-icon class="mr-2" [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                    Aplicar rango
                                </button>
                            </div>

                            <!-- FECHA ESPECÍFICA (MÓVIL) -->
                            <div *ngIf="rangoFechaSeleccionado === 'fecha_especifica'" class="pt-6 space-y-5">
                                <h4 class="text-lg font-semibold text-primary">Fecha específica</h4>

                                <!-- Selector de fecha -->
                                <div>
                                    <label class="block text-sm font-medium text-primary mb-2">Selecciona una
                                        fecha</label>
                                    <mat-form-field class="w-full fuse-mat-dense fuse-mat-rounded-lg"
                                        appearance="outline">
                                        <input matInput [matDatepicker]="pickerFechaUnicaMovil"
                                            [formControl]="fechaInicioControl" placeholder="dd/mm/aaaa">

                                        <mat-datepicker-toggle matIconSuffix [for]="pickerFechaUnicaMovil">
                                        </mat-datepicker-toggle>

                                        <mat-datepicker #pickerFechaUnicaMovil touchUi>
                                        </mat-datepicker>
                                    </mat-form-field>
                                </div>

                                <!-- Botón aplicar -->
                                <button mat-flat-button color="primary"
                                    class="w-full h-14 rounded-full font-bold text-lg shadow-lg text-white dark:text-white"
                                    (click)="aplicarFiltroFechas()">
                                    <mat-icon class="mr-2" [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                    Aplicar fecha
                                </button>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- 2. Departamento -->
                <mat-form-field class="w-full fuse-mat-dense fuse-mat-rounded-lg" appearance="outline"
                    [subscriptSizing]="'dynamic'">
                    <mat-icon matPrefix class="text-primary" [svgIcon]="'heroicons_solid:building-office-2'"></mat-icon>
                    <mat-label class="font-medium">Departamento</mat-label>
                    <mat-select [formControl]="deptoControl">
                        <mat-option [value]="''"><span class="text-gray-500">Todos los departamentos</span></mat-option>
                        <mat-option *ngFor="let depto of departamentosUnicos" [value]="depto">{{ depto }}</mat-option>
                    </mat-select>
                </mat-form-field>

                <!-- 3. Proceso -->
                <mat-form-field class="w-full fuse-mat-dense fuse-mat-rounded-lg" appearance="outline"
                    [subscriptSizing]="'dynamic'">
                    <mat-icon matPrefix class="text-primary" [svgIcon]="'heroicons_solid:cog-8-tooth'"></mat-icon>
                    <mat-label class="font-medium">Proceso</mat-label>
                    <mat-select [formControl]="procesoControl">
                        <mat-option [value]="''"><span class="text-gray-500">Todos los procesos</span></mat-option>
                        <mat-option *ngFor="let proceso of procesosUnicos" [value]="proceso">{{ proceso }}</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>

            <!-- Footer con acciones -->
            <div class="p-5 border-t border-gray-200 dark:border-gray-700 space-y-3 bg-white dark:bg-gray-900">
                <button mat-stroked-button class="w-full h-12 rounded-xl font-medium"
                    (click)="limpiarTodosFiltros(); togglePanelFiltros()">
                    Limpiar todos los filtros
                </button>
            </div>
        </div>
    </div>

    <!-- FILTROS DE PC -->
    <div class="hidden md:block">
        <!-- Filters Section -->
        <div class="flex flex-col gap-3 p-4 sm:p-6 md:px-8 border-b bg-gray-50 dark:bg-gray-900">

            <!-- Primera fila: Fecha y Search -->
            <div class="flex flex-col sm:flex-row gap-3">
                <!-- Filtro de Rango de Fecha con Panel -->
                <div class="relative w-full sm:w-auto">
                    <button mat-stroked-button class="h-10 px-4 w-full sm:min-w-64" (click)="toggleDatePanel()">
                        <mat-icon class="icon-size-5 mr-2" [svgIcon]="'heroicons_solid:calendar'"></mat-icon>
                        <span class="text-sm truncate">{{ obtenerTextoFechaSeleccionada() }}</span>
                        <mat-icon class="icon-size-4 ml-auto" [svgIcon]="'heroicons_solid:chevron-down'"></mat-icon>
                    </button>

                    <!-- Panel de Filtros de Fecha - Ultra Responsive -->
                    <div *ngIf="mostrarPanelFechas" class="fixed top-[5rem] left-2 right-2 sm:absolute sm:top-full sm:left-0 sm:right-auto sm:mt-2 
                           bg-white dark:bg-gray-800 rounded-lg shadow-2xl border border-gray-200 dark:border-gray-700 
                           z-50 w-auto sm:w-96 max-w-[calc(100vw-1rem)] sm:max-w-none 
                           max-h-[calc(100vh-6rem)] overflow-hidden flex flex-col">

                        <!-- Header del Panel - Sticky -->
                        <div
                            class="sticky top-0 bg-white dark:bg-gray-800 z-20 flex items-center justify-between p-3 sm:p-4 border-b border-gray-200 dark:border-gray-700 shrink-0">
                            <div class="flex items-center gap-2 min-w-0">
                                <mat-icon class="icon-size-5 sm:icon-size-6 text-primary shrink-0"
                                    [svgIcon]="'heroicons_solid:calendar'"></mat-icon>
                                <h3 class="text-base sm:text-lg font-semibold truncate">Filtrar por fechas</h3>
                            </div>
                            <div class="flex items-center gap-1 sm:gap-2 shrink-0">
                                <button mat-button
                                    class="text-primary font-medium text-xs sm:text-sm min-w-0 px-2 sm:px-4"
                                    (click)="limpiarFiltroFechas()">
                                    Limpiar
                                </button>
                                <button mat-icon-button class="w-8 h-8 sm:w-10 sm:h-10" (click)="toggleDatePanel()">
                                    <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:x-mark'"></mat-icon>
                                </button>
                            </div>
                        </div>

                        <!-- Contenido con Scroll -->
                        <div class="overflow-y-auto flex-1">
                            <!-- Opciones del Catálogo en dos columnas -->
                            <div class="p-3 sm:p-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                                    <!-- Columna 1 -->
                                    <div class="space-y-2">
                                        <!-- VER TODOS (PC) -->
                                        <button mat-flat-button class="w-full h-11 sm:h-12 rounded-lg font-semibold mb-3
           border-2 transition-all" [ngClass]="{
        'bg-primary border-primary text-white': rangoFechaSeleccionado === 'todos',
        'bg-white border-gray-300 text-black dark:bg-gray-800 dark:text-white': rangoFechaSeleccionado !== 'todos'
    }" (click)="seleccionarRangoFecha('todos')">

                                            <span class="flex-1 text-left">Ver todos</span>

                                            <mat-icon *ngIf="rangoFechaSeleccionado === 'todos'" class="icon-size-5"
                                                [svgIcon]="'heroicons_solid:check'">
                                            </mat-icon>
                                        </button>

                                        <!-- Hoy -->
                                        <button mat-button class="w-full justify-start h-11 sm:h-12 rounded-lg text-sm sm:text-base
           border-2 transition-all" [ngClass]="{
        'bg-primary border-primary text-white': rangoFechaSeleccionado === 'hoy',
        'border-gray-300 text-black hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700': rangoFechaSeleccionado !== 'hoy'
    }" (click)="seleccionarRangoFecha('hoy')">

                                            <span class="flex-1 text-left">Hoy</span>
                                            <mat-icon *ngIf="rangoFechaSeleccionado === 'hoy'" class="icon-size-5"
                                                [svgIcon]="'heroicons_solid:check'">
                                            </mat-icon>
                                        </button>

                                        <!-- Ayer -->
                                        <button mat-button class="w-full justify-start h-11 sm:h-12 rounded-lg text-sm sm:text-base
           border-2 transition-all" [ngClass]="{
        'bg-primary border-primary text-white': rangoFechaSeleccionado === 'ayer',
        'border-gray-300 text-black hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700': rangoFechaSeleccionado !== 'ayer'
    }" (click)="seleccionarRangoFecha('ayer')">

                                            <span class="flex-1 text-left">Ayer</span>
                                            <mat-icon *ngIf="rangoFechaSeleccionado === 'ayer'" class="icon-size-5"
                                                [svgIcon]="'heroicons_solid:check'">
                                            </mat-icon>
                                        </button>

                                        <!-- Mes actual -->
                                        <button mat-button class="w-full justify-start h-11 sm:h-12 rounded-lg text-sm sm:text-base
           border-2 transition-all" [ngClass]="{
        'bg-primary border-primary text-white': rangoFechaSeleccionado === 'mes_actual',
        'border-gray-300 text-black hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700': rangoFechaSeleccionado !== 'mes_actual'
    }" (click)="seleccionarRangoFecha('mes_actual')">

                                            <span class="flex-1 text-left">Mes actual</span>
                                            <mat-icon *ngIf="rangoFechaSeleccionado === 'mes_actual'"
                                                class="icon-size-5" [svgIcon]="'heroicons_solid:check'">
                                            </mat-icon>
                                        </button>

                                    </div>

                                    <!-- Columna 2 -->
                                    <div class="space-y-2">
                                        <!-- Mes anterior -->
                                        <button mat-button class="w-full justify-start h-11 sm:h-12 rounded-lg text-sm sm:text-base
           border-2 transition-all" [ngClass]="{
        'bg-primary border-primary text-white': rangoFechaSeleccionado === 'mes_anterior',
        'border-gray-300 text-black hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700': rangoFechaSeleccionado !== 'mes_anterior'
    }" (click)="seleccionarRangoFecha('mes_anterior')">

                                            <span class="flex-1 text-left">Mes anterior</span>
                                            <mat-icon *ngIf="rangoFechaSeleccionado === 'mes_anterior'"
                                                class="icon-size-5" [svgIcon]="'heroicons_solid:check'">
                                            </mat-icon>
                                        </button>

                                        <!-- Seleccionar fecha -->
                                        <button mat-button class="w-full justify-start h-11 sm:h-12 rounded-lg text-sm sm:text-base
           border-2 transition-all" [ngClass]="{
        'bg-primary border-primary text-white': rangoFechaSeleccionado === 'fecha_especifica',
        'border-gray-300 text-black hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700': rangoFechaSeleccionado !== 'fecha_especifica'
    }" (click)="seleccionarRangoFecha('fecha_especifica')">

                                            <span class="flex-1 text-left">Seleccionar fecha</span>
                                            <mat-icon *ngIf="rangoFechaSeleccionado === 'fecha_especifica'"
                                                class="icon-size-5" [svgIcon]="'heroicons_solid:check'">
                                            </mat-icon>
                                        </button>

                                        <!-- Periodo de fechas -->
                                        <button mat-button class="w-full justify-start h-11 sm:h-12 rounded-lg text-sm sm:text-base
           border-2 transition-all" [ngClass]="{
        'bg-primary border-primary text-white': rangoFechaSeleccionado === 'periodo',
        'border-gray-300 text-black hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700': rangoFechaSeleccionado !== 'periodo'
    }" (click)="seleccionarRangoFecha('periodo')">

                                            <span class="flex-1 text-left">Periodo de fechas</span>
                                            <mat-icon *ngIf="rangoFechaSeleccionado === 'periodo'" class="icon-size-5"
                                                [svgIcon]="'heroicons_solid:check'">
                                            </mat-icon>
                                        </button>

                                    </div>
                                </div>
                            </div>

                            <!-- Selector de Fecha Específica -->
                            <div *ngIf="rangoFechaSeleccionado === 'fecha_especifica'"
                                class="p-3 sm:p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
                                <h4 class="text-sm font-medium mb-3">Selecciona una fecha</h4>

                                <div class="space-y-3">
                                    <mat-form-field class="w-full fuse-mat-dense fuse-mat-rounded"
                                        [subscriptSizing]="'dynamic'">
                                        <mat-label>Fecha</mat-label>
                                        <input matInput [matDatepicker]="pickerUnica" [formControl]="fechaInicioControl"
                                            placeholder="dd/mm/aaaa">
                                        <mat-datepicker-toggle matIconSuffix
                                            [for]="pickerUnica"></mat-datepicker-toggle>
                                        <mat-datepicker #pickerUnica></mat-datepicker>
                                    </mat-form-field>

                                    <button mat-flat-button color="primary" class="w-full h-10 text-sm sm:text-base"
                                        (click)="aplicarFiltroFechas()">
                                        <mat-icon class="icon-size-5 mr-2"
                                            [svgIcon]="'heroicons_solid:funnel'"></mat-icon>
                                        <span>Aplicar</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Rango Personalizado (Periodo) -->
                            <div *ngIf="rangoFechaSeleccionado === 'periodo'"
                                class="p-3 sm:p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
                                <h4 class="text-sm font-medium mb-3">Rango personalizado</h4>

                                <div class="space-y-3">
                                    <!-- Fecha Desde -->
                                    <mat-form-field class="w-full fuse-mat-dense fuse-mat-rounded"
                                        [subscriptSizing]="'dynamic'">
                                        <mat-label>Fecha Desde</mat-label>
                                        <input matInput [matDatepicker]="pickerInicio"
                                            [formControl]="fechaInicioControl" placeholder="dd/mm/aaaa">
                                        <mat-datepicker-toggle matIconSuffix
                                            [for]="pickerInicio"></mat-datepicker-toggle>
                                        <mat-datepicker #pickerInicio></mat-datepicker>
                                    </mat-form-field>

                                    <!-- Fecha Hasta -->
                                    <mat-form-field class="w-full fuse-mat-dense fuse-mat-rounded"
                                        [subscriptSizing]="'dynamic'">
                                        <mat-label>Fecha Hasta</mat-label>
                                        <input matInput [matDatepicker]="pickerFin" [formControl]="fechaFinControl"
                                            placeholder="dd/mm/aaaa">
                                        <mat-datepicker-toggle matIconSuffix [for]="pickerFin"></mat-datepicker-toggle>
                                        <mat-datepicker #pickerFin></mat-datepicker>
                                    </mat-form-field>

                                    <!-- Botón Aplicar -->
                                    <button mat-flat-button color="primary" class="w-full h-10 text-sm sm:text-base"
                                        (click)="aplicarFiltroFechas()">
                                        <mat-icon class="icon-size-5 mr-2"
                                            [svgIcon]="'heroicons_solid:funnel'"></mat-icon>
                                        <span>Aplicar rango</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Search -->
                <mat-form-field class="fuse-mat-dense fuse-mat-rounded flex-auto w-full sm:flex-1"
                    [subscriptSizing]="'dynamic'">
                    <mat-icon matPrefix class="icon-size-5" [svgIcon]="'heroicons_solid:magnifying-glass'"></mat-icon>
                    <input matInput [formControl]="searchControl" [autocomplete]="'off'" placeholder="Buscar...">
                </mat-form-field>
            </div>

            <!-- Segunda fila: Departamento y Proceso -->
            <div class="flex flex-col sm:flex-row gap-3">
                <!-- Departamento Filter -->
                <mat-form-field class="fuse-mat-dense fuse-mat-rounded w-full sm:flex-1" [subscriptSizing]="'dynamic'">
                    <mat-icon matPrefix class="icon-size-5" [svgIcon]="'heroicons_solid:building-office'"></mat-icon>
                    <mat-select [formControl]="deptoControl" placeholder="Departamento">
                        <mat-option [value]="''">Todos</mat-option>
                        <mat-option *ngFor="let depto of departamentosUnicos" [value]="depto">
                            {{ depto }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>

                <!-- Proceso Filter -->
                <mat-form-field class="fuse-mat-dense fuse-mat-rounded w-full sm:flex-1" [subscriptSizing]="'dynamic'">
                    <mat-icon matPrefix class="icon-size-5" [svgIcon]="'heroicons_solid:cog'"></mat-icon>
                    <mat-select [formControl]="procesoControl" placeholder="Proceso">
                        <mat-option [value]="''">Todos</mat-option>
                        <mat-option *ngFor="let proceso of procesosUnicos" [value]="proceso">
                            {{ proceso }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>

        </div>

        <!-- Overlay para cerrar el panel al hacer clic fuera -->
        <div *ngIf="mostrarPanelFechas" class="fixed inset-0 bg-black bg-opacity-30 z-40" (click)="toggleDatePanel()">
        </div>
    </div>

    <!-- Main content -->
    <div class="flex flex-auto overflow-hidden">
        <div class="flex flex-col flex-auto overflow-hidden sm:overflow-y-auto">

            <!-- Loading -->
            <!-- <mat-progress-bar *ngIf="isLoading" mode="indeterminate"></mat-progress-bar> -->

            <!-- Empty state -->
            <ng-container *ngIf="!isLoading && datosFiltrados.length === 0">
                <div class="flex flex-auto flex-col items-center justify-center bg-gray-100 dark:bg-transparent p-4">
                    <mat-icon class="icon-size-16 sm:icon-size-24 text-hint"
                        [svgIcon]="'heroicons_outline:inbox'"></mat-icon>
                    <div
                        class="mt-4 text-xl sm:text-2xl font-semibold tracking-tight text-black dark:text-white text-center">
                        No hay datos de producción
                    </div>
                    <div class="mt-2 text-sm sm:text-md text-black dark:text-white text-center px-4">
                        No se encontraron registros con los filtros aplicados.
                    </div>
                </div>
            </ng-container>

            <!-- Table -->
            <ng-container *ngIf="!isLoading && datosFiltrados.length > 0">

                <!-- Summary cards -->
                <div class="p-4 sm:p-6 md:px-8">
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4">
                        <!-- Tarjeta: Cantidad Total (siempre visible, centrada en móvil) -->
                        <div
                            class="bg-card shadow rounded-lg p-3 sm:p-4 border-l-4 border-green-500 sm:col-span-1 col-span-1">
                            <div class="text-xs sm:text-sm text-black dark:text-white mb-1">Cantidad Total</div>
                            <div class="text-xl sm:text-2xl font-bold truncate">{{ calcularCantidadTotal() |
                                number:'1.2-2' }} kg</div>
                        </div>

                        <!-- Las otras dos tarjetas solo visibles a partir de sm (≥640px) -->
                        <div class="hidden sm:block bg-card shadow rounded-lg p-3 sm:p-4 border-l-4 border-blue-500">
                            <div class="text-xs sm:text-sm text-black dark:text-white mb-1">Total Registros</div>
                            <div class="text-xl sm:text-2xl font-bold">{{ datosFiltrados.length }}</div>
                        </div>

                        <div class="hidden sm:block bg-card shadow rounded-lg p-3 sm:p-4 border-l-4 border-purple-500">
                            <div class="text-xs sm:text-sm text-black dark:text-white mb-1">Departamentos</div>
                            <div class="text-xl sm:text-2xl font-bold">{{ contarDepartamentos() }}</div>
                        </div>
                    </div>
                </div>

                <!-- Table container -->
                <div class="overflow-x-auto px-3 md:px-8 pb-6">
                    <table class="w-full bg-card shadow rounded-lg overflow-hidden">

                        <thead class="bg-gray-100 dark:bg-gray-700">
                            <tr>

                                <th class="px-3 py-3 text-left text-xs font-semibold text-black dark:text-white uppercase tracking-wider cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700"
                                    (click)="ordenar('departamento')">
                                    <div class="flex items-center">
                                        <span>Departamento</span>
                                        <mat-icon class="icon-size-4 ml-1"
                                            [svgIcon]="'heroicons_solid:arrows-up-down'"></mat-icon>
                                    </div>
                                </th>
                                <th class=" px-3 py-3 text-left text-xs font-semibold text-black dark:text-white uppercase tracking-wider cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700"
                                    (click)="ordenar('proceso')">
                                    <div class="flex items-center justify-center w-full">
                                        <span>Proceso</span>
                                        <mat-icon class="icon-size-4 ml-1"
                                            [svgIcon]="'heroicons_solid:arrows-up-down'"></mat-icon>
                                    </div>
                                </th>
                                <th class=" px-3 py-3 text-right text-xs font-semibold text-black dark:text-white uppercase tracking-wider cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700"
                                    (click)="ordenar('CANTIDAD')">
                                    <div class="flex items-center justify-end">
                                        <span>Cantidad (kg)</span>
                                        <mat-icon class="icon-size-4 ml-1"
                                            [svgIcon]="'heroicons_solid:arrows-up-down'"></mat-icon>
                                    </div>
                                </th>
                            </tr>
                        </thead>

                        <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                            <tr *ngFor="let dato of datosFiltrados; trackBy: trackByFn"
                                class="hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">

                                <td class="px-3 py-3 text-sm">
                                    <div class="flex items-center">
                                        <mat-icon class="icon-size-5 text-blue-500 mr-2 hidden md:block"
                                            [svgIcon]="'heroicons_solid:building-office'"></mat-icon>
                                        <span class="font-medium">{{ dato.departamento }}</span>
                                    </div>
                                </td>
                                <td class="py-3 text-sm text-center">
                                    {{ dato.proceso }}
                                </td>
                                <td class="px-3 py-3 text-sm text-right">
                                    <span class="font-bold text-green-600 dark:text-green-400">
                                        {{ dato.CANTIDAD | number:'1.2-2' }}
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                        <tfoot class="bg-gray-50 dark:bg-gray-700   font-bold">
                            <tr>
                                <!-- Texto "Total" ocupa las dos primeras columnas -->
                                <td colspan="2"
                                    class="px-4 py-3 text-right text-sm uppercase text-black dark:text-white-500 dark:text-white ">
                                    Total:
                                </td>

                                <!-- Cantidad totalmente pegada a la derecha -->
                                <td class="px-4 py-3 text-right text-sm text-green-600 dark:text-green-400 ">
                                    {{ calcularCantidadTotal() | number:'1.2-2' }}
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </ng-container>
        </div>
    </div>

</div>