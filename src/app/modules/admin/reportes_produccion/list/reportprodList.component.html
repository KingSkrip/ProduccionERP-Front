<div class="absolute inset-0 flex flex-col min-w-0 overflow-hidden bg-gray-50 dark:bg-gray-900">

    <!-- ===== HEADER MEJORADO ===== -->
    <div class="relative bg-gray-50 dark:bg-gray-900">
        <div class="relative py-2 md:py-6 px-6 md:px-8">
            <div class="flex items-start gap-4 max-w-7xl mx-auto">
                <div
                    class="flex items-center justify-center w-14 h-14 rounded-2xl bg-primary backdrop-blur-sm shadow-lg ring-1 ring-white/20">
                    <mat-icon class="text-white icon-size-7" [svgIcon]="'heroicons_outline:chart-bar'"></mat-icon>
                </div>
                <div class="flex-1">
                    <h1 class="text-2xl md:text-4xl font-bold text-black dark:text-white tracking-tight">
                        Reportes de Producción
                    </h1>
                    <p class=" text-black dark:text-white mt-1.5 text-sm md:text-base">
                        Analiza la producción por departamento y proceso
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== BARRA DE FILTROS MÓVIL (STICKY) ===== -->
    <div class="md:hidden sticky top-0 bg-gray-50 dark:bg-gray-900">
        <div class="flex items-center px-3 gap-2">
            <mat-form-field class="fuse-mat-dense flex-1" appearance="outline" [subscriptSizing]="'dynamic'">
                <mat-icon matPrefix class="text-gray-400 icon-size-5"
                    [svgIcon]="'heroicons_outline:magnifying-glass'"></mat-icon>
                <input matInput [formControl]="searchControl" [autocomplete]="'off'" placeholder="Buscar...">
            </mat-form-field>

            <button mat-mini-fab color="primary" class="shadow-md relative" (click)="togglePanelFiltros()"
                [matBadge]="filtrosActivosCount()" matBadgeSize="small" matBadgeColor="accent"
                [matBadgeHidden]="filtrosActivosCount() === 0">
                <mat-icon [svgIcon]="'heroicons_outline:adjustments-horizontal'"></mat-icon>
            </button>
        </div>
    </div>

    <!-- Overlay oscuro móvil -->
    <div *ngIf="mostrarPanelFiltros" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-40 md:hidden"
        (click)="togglePanelFiltros()" [@fadeIn]>
    </div>

    <!-- Panel de filtros - ventana chica desde abajo -->
    <div *ngIf="mostrarPanelFiltros"
        class="md:hidden fixed bottom-0 left-0 right-0 z-50 bg-card rounded-t-3xl shadow-2xl max-h-[85vh] flex flex-col">

        <!-- Header -->
        <div class="flex items-center justify-between p-4 border-b">
            <h2 class="text-lg font-semibold">Filtros Avanzados</h2>
            <button mat-icon-button (click)="togglePanelFiltros()">
                <mat-icon [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
            </button>
        </div>

        <!-- Contenido scrolleable -->
        <div class="flex-1 overflow-y-auto p-4 space-y-5">

            <!-- SECCIÓN: RANGO DE FECHA -->
            <div>
                <div class="flex items-center gap-2 mb-3">
                    <mat-icon class="text-primary icon-size-5" [svgIcon]="'heroicons_outline:calendar-days'"></mat-icon>
                    <h3 class="font-medium text-sm">Rango de Fecha</h3>
                </div>

                <div class="grid grid-cols-2 gap-2">
                    <button mat-stroked-button class="h-10 rounded-full text-sm"
                        [ngClass]="{'!bg-primary !border-primary !text-white': rangoFechaSeleccionado === 'todos'}"
                        (click)="seleccionarRangoFecha('todos')">
                        Todos
                    </button>

                    <button mat-stroked-button class="h-10 rounded-full text-sm"
                        [ngClass]="{'!bg-primary !border-primary !text-white': rangoFechaSeleccionado === 'hoy'}"
                        (click)="seleccionarRangoFecha('hoy')">
                        Hoy
                    </button>

                    <button mat-stroked-button class="h-10 rounded-full text-sm"
                        [ngClass]="{'!bg-primary !border-primary !text-white': rangoFechaSeleccionado === 'ayer'}"
                        (click)="seleccionarRangoFecha('ayer')">
                        Ayer
                    </button>

                    <button mat-stroked-button class="h-10 rounded-full text-sm"
                        [ngClass]="{'!bg-primary !border-primary !text-white': rangoFechaSeleccionado === 'mes_actual'}"
                        (click)="seleccionarRangoFecha('mes_actual')">
                        Este mes
                    </button>

                    <button mat-stroked-button class="h-10 rounded-full text-sm"
                        [ngClass]="{'!bg-primary !border-primary !text-white': rangoFechaSeleccionado === 'mes_anterior'}"
                        (click)="seleccionarRangoFecha('mes_anterior')">
                        Mes ant.
                    </button>

                    <button mat-stroked-button class="h-10 rounded-full text-sm"
                        [ngClass]="{'!bg-primary !border-primary !text-white': rangoFechaSeleccionado === 'fecha_especifica'}"
                        (click)="seleccionarRangoFecha('fecha_especifica')">
                        Fecha específica
                    </button>

                    <button mat-stroked-button class="h-10 rounded-full text-sm col-span-2"
                        [ngClass]="{'!bg-primary !border-primary !text-white': rangoFechaSeleccionado === 'periodo'}"
                        (click)="seleccionarRangoFecha('periodo')">
                        Periodo personalizado
                    </button>
                </div>

                <!-- Panel de fecha específica -->
                <div *ngIf="rangoFechaSeleccionado === 'fecha_especifica'"
                    class="mt-4 p-4 bg-primary/5 rounded-xl space-y-3">
                    <h4 class="font-semibold text-sm">Selecciona una fecha</h4>
                    <mat-form-field class="w-full" appearance="outline">
                        <input matInput [matDatepicker]="pickerMovilUnica" [formControl]="fechaInicioControl">
                        <mat-datepicker-toggle matIconSuffix [for]="pickerMovilUnica"></mat-datepicker-toggle>
                        <mat-datepicker #pickerMovilUnica touchUi></mat-datepicker>
                    </mat-form-field>
                </div>

                <!-- Panel de periodo personalizado -->
                <div *ngIf="rangoFechaSeleccionado === 'periodo'" class="mt-4 p-4 bg-primary/5 rounded-xl space-y-3">
                    <h4 class="font-semibold text-sm">Rango personalizado</h4>
                    <mat-form-field class="w-full" appearance="outline">
                        <mat-label>Fecha Desde</mat-label>
                        <input matInput [matDatepicker]="pickerMovilInicio" [formControl]="fechaInicioControl">
                        <mat-datepicker-toggle matIconSuffix [for]="pickerMovilInicio"></mat-datepicker-toggle>
                        <mat-datepicker #pickerMovilInicio touchUi></mat-datepicker>
                    </mat-form-field>
                    <mat-form-field class="w-full" appearance="outline">
                        <mat-label>Fecha Hasta</mat-label>
                        <input matInput [matDatepicker]="pickerMovilFin" [formControl]="fechaFinControl">
                        <mat-datepicker-toggle matIconSuffix [for]="pickerMovilFin"></mat-datepicker-toggle>
                        <mat-datepicker #pickerMovilFin touchUi></mat-datepicker>
                    </mat-form-field>
                </div>
            </div>

            <!-- SECCIÓN: DEPARTAMENTO -->
            <div>
                <div class="flex items-center gap-2 mb-3">
                    <mat-icon class="text-primary icon-size-5"
                        [svgIcon]="'heroicons_outline:building-office-2'"></mat-icon>
                    <h3 class="font-medium text-sm">Departamento</h3>
                </div>

                <mat-form-field class="w-full" appearance="outline">
                    <mat-select [formControl]="deptoControl" placeholder="Todos los departamentos">
                        <mat-option [value]="''">Todos los departamentos</mat-option>
                        <mat-option *ngFor="let depto of departamentosUnicos" [value]="depto">
                            {{ depto }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
        </div>

        <!-- Footer con botones -->
        <div class="p-4 border-t bg-card">
            <div class="flex gap-2">
                <button mat-stroked-button class="flex-1 h-11 rounded-full" (click)="limpiarTodosFiltros()">
                    Limpiar
                </button>
                <button mat-flat-button color="primary" class="flex-1 h-11 rounded-full"
                    (click)="aplicarFiltrosMovil()">
                    Aplicar
                </button>
            </div>
        </div>
    </div>

    <!-- ===== FILTROS PC - MENÚ DESPLEGABLE ===== -->
    <div class="hidden md:block">
        <div class="max-w-7xl mx-auto w-full md:px-6">
            <div class="flex  gap-3">
                <mat-form-field class="fuse-mat-dense fuse-mat-rounded flex-1">
                    <mat-icon matPrefix [svgIcon]="'heroicons_outline:magnifying-glass'"></mat-icon>
                    <input matInput [formControl]="searchControl" placeholder="Buscar...">
                </mat-form-field>


                <!-- Botón de filtros -->
                <div class="relative">
                    <button mat-stroked-button
                        class="h-11 px-5 rounded-3xl border-2 hover:border-primary/40 transition-all bg-primary-500"
                        [class.border-primary]="filtrosActivosCount() > 0" (click)="togglePanelFiltrosPc()">

                        <span class="flex items-center gap-2 w-full">
                            <!-- Icono filtros -->
                            <mat-icon class="icon-size-5 text-white" [class.text-primary]="filtrosActivosCount() > 0"
                                [svgIcon]="'heroicons_outline:adjustments-horizontal'">
                            </mat-icon>

                            <!-- Texto -->
                            <span class="text-sm font-medium text-white">
                                Filtros
                            </span>

                            <!-- Badge -->
                            <span *ngIf="filtrosActivosCount() > 0"
                                class="ml-1 px-2 py-0.5 bg-primary text-white rounded-full text-xs font-semibold leading-none">
                                {{ filtrosActivosCount() }}
                            </span>

                            <!-- Chevron (SIEMPRE al final) -->
                            <mat-icon class="icon-size-4 text-white transition-transform ml-auto"
                                [class.rotate-180]="mostrarPanelFiltrosPc" [svgIcon]="'heroicons_outline:chevron-down'">
                            </mat-icon>
                        </span>

                    </button>

                    <!-- Panel desplegable de filtros -->
                    <div *ngIf="mostrarPanelFiltrosPc" class="absolute top-full right-0 mt-2 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl border-2 z-50
         w-[480px] flex flex-col max-h-[calc(70vh-70px)] min-h-0" [@slideDown]>


                        <!-- Header del panel -->
                        <div class="p-2 border-b bg-gradient-to-r from-primary/5 to-transparent flex-shrink-0">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center">
                                        <mat-icon class="text-primary-500 icon-size-5"
                                            [svgIcon]="'heroicons_outline:funnel'"></mat-icon>
                                    </div>
                                    <h3 class="font-semibold text-lg">Filtros Avanzados</h3>
                                </div>
                                <button mat-icon-button (click)="togglePanelFiltrosPc()"
                                    class="hover:bg-gray-100 dark:hover:bg-gray-700">
                                    <mat-icon class="icon-size-5" [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
                                </button>
                            </div>
                        </div>

                        <!-- Contenido scrolleable -->
                        <div class="flex-1 min-h-0 overflow-y-auto p-5 space-y-5">

                            <!-- SECCIÓN: RANGO DE FECHA -->
                            <div>
                                <div class="flex items-center gap-2 mb-3">
                                    <mat-icon class="text-primary icon-size-5"
                                        [svgIcon]="'heroicons_outline:calendar-days'"></mat-icon>
                                    <h4 class="font-semibold">Rango de Fecha</h4>
                                </div>

                                <div class="space-y-2">

                                    <button mat-button
                                        class="w-full h-11 rounded-xl justify-center px-4 text-left transition-all flex items-center"
                                        [ngClass]="rangoFechaSeleccionado === 'todos'
                                        ? 'bg-primary text-white shadow-md': 'hover:bg-gray-50 dark:hover:bg-gray-700'"
                                        (click)="seleccionarRangoFecha('todos')">
                                        <mat-icon class="icon-size-5 mr-3" [ngClass]="rangoFechaSeleccionado === 'todos'
                                        ? 'text-white': 'text-gray-400'" [svgIcon]="'heroicons_outline:queue-list'">
                                        </mat-icon>
                                        <span class="flex-1 font-medium">
                                            Todos los registros
                                        </span>

                                        <!-- Check -->
                                        <mat-icon *ngIf="rangoFechaSeleccionado === 'todos'"
                                            class="icon-size-5 text-white" [svgIcon]="'heroicons_outline:check'">
                                        </mat-icon>

                                    </button>


                                    <div class="grid grid-cols-3 gap-3 items-center">
                                        <button mat-button
                                            class="h-10 rounded-xl justify-center px-3 transition-all flex items-center"
                                            [ngClass]="rangoFechaSeleccionado === 'hoy'
                                            ? 'bg-primary text-white shadow-md'
                                            : 'hover:bg-gray-50 dark:hover:bg-gray-700'"
                                            (click)="seleccionarRangoFecha('hoy')">
                                            <mat-icon class="icon-size-4 mr-2" [ngClass]="rangoFechaSeleccionado === 'hoy'
                                            ? 'text-white'
                                            : 'text-gray-400'" [svgIcon]="'heroicons_outline:sun'">
                                            </mat-icon>
                                            <span class="font-medium ">
                                                Hoy
                                            </span>
                                        </button>

                                        <button mat-button
                                            class="h-10 rounded-xl justify-center px-3 transition-all flex items-center"
                                            [ngClass]="rangoFechaSeleccionado === 'ayer'
                                            ? 'bg-primary text-white shadow-md'
                                            : 'hover:bg-gray-50 dark:hover:bg-gray-700'"
                                            (click)="seleccionarRangoFecha('ayer')">

                                            <mat-icon class="icon-size-4 mr-2" [ngClass]="rangoFechaSeleccionado === 'ayer'
                                            ? 'text-white'
                                            : 'text-gray-400'" [svgIcon]="'heroicons_outline:moon'">
                                            </mat-icon>

                                            <span class="font-medium">Ayer</span>
                                        </button>

                                        <button mat-button
                                            class="h-10 rounded-xl justify-center px-3 transition-all flex items-center"
                                            [ngClass]="rangoFechaSeleccionado === 'mes_actual'
                                            ? 'bg-primary text-white shadow-md'
                                            : 'hover:bg-gray-50 dark:hover:bg-gray-700'"
                                            (click)="seleccionarRangoFecha('mes_actual')">

                                            <mat-icon class="icon-size-4 mr-2" [ngClass]="rangoFechaSeleccionado === 'mes_actual'
                                            ? 'text-white'
                                            : 'text-gray-400'" [svgIcon]="'heroicons_outline:calendar-days'">
                                            </mat-icon>

                                            <span class="font-medium">Este mes</span>
                                        </button>


                                        <button mat-button
                                            class="h-10 rounded-xl justify-center px-3 transition-all flex items-center"
                                            [ngClass]="rangoFechaSeleccionado === 'mes_anterior'
                                            ? 'bg-primary text-white shadow-md'
                                            : 'hover:bg-gray-50 dark:hover:bg-gray-700'"
                                            (click)="seleccionarRangoFecha('mes_anterior')">

                                            <mat-icon class="icon-size-4 mr-2" [ngClass]="rangoFechaSeleccionado === 'mes_anterior'
                                            ? 'text-white'
                                            : 'text-gray-400'" [svgIcon]="'heroicons_outline:arrow-uturn-left'">
                                            </mat-icon>

                                            <span class="font-medium">Mes ant.</span>
                                        </button>

                                        <button mat-stroked-button
                                            class="h-10 rounded-xl border-2 transition-all flex items-center" [ngClass]="rangoFechaSeleccionado === 'fecha_especifica'
                                            ? 'border-primary bg-primary/5': ''"
                                            (click)="seleccionarRangoFecha('fecha_especifica')">
                                            <mat-icon class="icon-size-4 mr-2" [ngClass]="rangoFechaSeleccionado === 'fecha_especifica'
                                            ? 'text-primary': 'text-gray-400'" [svgIcon]="'heroicons_outline:calendar'">
                                            </mat-icon>
                                            <span class="font-medium" [ngClass]="rangoFechaSeleccionado === 'fecha_especifica'
                                            ? 'text-primary': ''">
                                                Fecha específica
                                            </span>
                                        </button>

                                        <button mat-stroked-button
                                            class="h-10 rounded-xl border-2 transition-all flex items-center" [ngClass]="rangoFechaSeleccionado === 'periodo'
                                            ? 'border-primary bg-primary/5'
                                            : ''" (click)="seleccionarRangoFecha('periodo')">

                                            <mat-icon class="icon-size-4 mr-2" [ngClass]="rangoFechaSeleccionado === 'periodo'
                                            ? 'text-primary'
                                            : 'text-gray-400'" [svgIcon]="'heroicons_outline:arrow-trending-up'">
                                            </mat-icon>

                                            <span class="font-medium" [ngClass]="rangoFechaSeleccionado === 'periodo'
                                            ? 'text-primary'
                                            : ''">
                                                Periodo
                                            </span>
                                        </button>

                                    </div>
                                </div>

                                <!-- Panel de fecha específica -->
                                <div *ngIf="rangoFechaSeleccionado === 'fecha_especifica'"
                                    class="mt-4 p-4 bg-gray-50 dark:bg-gray-900/50 rounded-xl space-y-3">
                                    <h5 class="text-sm font-semibold text-gray-600 dark:text-gray-400">
                                        Selecciona una fecha
                                    </h5>
                                    <mat-form-field class="w-full" appearance="outline">
                                        <input matInput readonly [matDatepicker]="pickerPcUnica"
                                            [formControl]="fechaInicioControl">
                                        <mat-datepicker-toggle matIconSuffix [for]="pickerPcUnica">
                                        </mat-datepicker-toggle>
                                        <mat-datepicker #pickerPcUnica></mat-datepicker>
                                    </mat-form-field>

                                </div>

                                <!-- Panel de periodo personalizado -->
                                <div *ngIf="rangoFechaSeleccionado === 'periodo'"
                                    class="mt-4 p-4 bg-gray-50 dark:bg-gray-900/50 rounded-xl space-y-3">
                                    <h5 class="text-sm font-semibold text-gray-600 dark:text-gray-400">
                                        Rango personalizado
                                    </h5>
                                    <mat-form-field class="w-full" appearance="outline">
                                        <mat-label>Fecha Desde</mat-label>
                                        <input matInput readonly [matDatepicker]="pickerPcInicio"
                                            [formControl]="fechaInicioControl">
                                        <mat-datepicker-toggle matIconSuffix [for]="pickerPcInicio">
                                        </mat-datepicker-toggle>
                                        <mat-datepicker #pickerPcInicio></mat-datepicker>
                                    </mat-form-field>

                                    <mat-form-field class="w-full" appearance="outline">
                                        <mat-label>Fecha Hasta</mat-label>
                                        <input matInput readonly [matDatepicker]="pickerPcFin"
                                            [formControl]="fechaFinControl">
                                        <mat-datepicker-toggle matIconSuffix [for]="pickerPcFin">
                                        </mat-datepicker-toggle>
                                        <mat-datepicker #pickerPcFin></mat-datepicker>
                                    </mat-form-field>


                                </div>
                            </div>

                            <!-- SECCIÓN: DEPARTAMENTO -->
                            <div class="pt-3 border-t">
                                <div class="flex items-center gap-2 mb-3">
                                    <mat-icon class="text-primary icon-size-5"
                                        [svgIcon]="'heroicons_outline:building-office-2'"></mat-icon>
                                    <h4 class="font-semibold">Departamento</h4>
                                </div>

                                <mat-form-field class="w-full" appearance="outline">
                                    <mat-select [formControl]="deptoControl" placeholder="Todos los departamentos">
                                        <mat-option [value]="''">
                                            <span class="font-medium">Todos los departamentos</span>
                                        </mat-option>
                                        <mat-option *ngFor="let depto of departamentosUnicos" [value]="depto">
                                            {{ depto }}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>

                        <!-- Footer con botones -->
                        <div class="p-4 border-t bg-gray-50 dark:bg-gray-900/50 flex-shrink-0">
                            <div class="flex gap-3">
                                <button mat-button
                                    class="flex-1 h-11 rounded-xl text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20"
                                    (click)="limpiarTodosFiltros()">
                                    <mat-icon class="icon-size-5 mr-2"
                                        [svgIcon]="'heroicons_outline:x-circle'"></mat-icon>
                                    Limpiar
                                </button>
                                <button mat-flat-button color="primary" class="flex-1 h-11 rounded-xl shadow-lg"
                                    (click)="aplicarFiltrosPc(); togglePanelFiltrosPc()">
                                    <mat-icon class="icon-size-5 mr-2" [svgIcon]="'heroicons_outline:check'"></mat-icon>
                                    Aplicar filtros
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Indicador de filtros activos -->
            <div *ngIf="filtrosActivosCount() > 0" class="flex items-center gap-2 text-sm mt-3">
                <mat-icon class="icon-size-4 text-primary" [svgIcon]="'heroicons_outline:funnel'"></mat-icon>
                <span class="text-gray-600 dark:text-gray-400">
                    <span class="font-semibold text-primary">{{ filtrosActivosCount() }}</span> filtro(s) activo(s)
                </span>
                <button mat-button class="text-xs h-7 rounded-lg ml-2" (click)="limpiarTodosFiltros()">
                    Limpiar todos
                </button>
            </div>
        </div>

        <!-- Overlay para cerrar panel -->
        <div *ngIf="mostrarPanelFiltrosPc" class="fixed inset-0 z-40" (click)="togglePanelFiltrosPc()"></div>
    </div>



    <!-- ===== CONTENIDO PRINCIPAL ===== -->
    <div class="flex flex-auto overflow-hidden">
        <div class="flex flex-col flex-auto overflow-y-auto">

     <!-- Router Outlet - Vistas hijas (Facturado, Tejido, etc.) -->
            <div class="max-w-7xl mx-auto w-full md:px-6 pb-6">
                <router-outlet></router-outlet>
            </div>


            <!-- Empty state mejorado -->
            <ng-container *ngIf="!isLoading && datosFiltrados.length === 0">
                <div class="flex flex-col items-center justify-center flex-auto p-8">
                    <div class="relative">
                        <div class="w-32 h-32 rounded-3xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center mb-6
                            shadow-inner ring-1 ring-primary/10">
                            <mat-icon class="icon-size-20 text-primary/40"
                                [svgIcon]="'heroicons_outline:inbox'"></mat-icon>
                        </div>
                        <div class="absolute -top-2 -right-2 w-8 h-8 rounded-full bg-primary/20 animate-pulse"></div>
                    </div>
                    <h3 class="text-2xl font-bold tracking-tight mb-2">No hay datos disponibles</h3>
                    <p class="text-gray-500 dark:text-gray-400 text-center max-w-md">
                        No se encontraron registros con los filtros seleccionados. Intenta ajustar tus criterios de
                        búsqueda.
                    </p>
                    <button mat-stroked-button class="mt-6 rounded-xl" (click)="limpiarTodosFiltros()">
                        <mat-icon class="icon-size-5 mr-2" [svgIcon]="'heroicons_outline:arrow-path'"></mat-icon>
                        Restablecer filtros
                    </button>
                </div>
            </ng-container>

            <!-- Contenido con datos -->
            <ng-container *ngIf="!isLoading && datosFiltrados.length > 0">
                <div class="max-w-7xl mx-auto w-full md:px-6 pb-2">


                </div>
            </ng-container>
        </div>
    </div>
</div>

<!-- padre -->