<div class="absolute inset-0 flex flex-col min-w-0 overflow-hidden bg-card dark:bg-transparent">

    <!-- ===== HEADER ===== -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between py-2 px-6 sm:px-8 border-b">
        <div class="flex items-center gap-4">
            <div class="flex items-center justify-center w-12 h-12 rounded-full bg-primary/10">
                <mat-icon class="text-primary icon-size-6" [svgIcon]="'heroicons_solid:chart-bar'"></mat-icon>
            </div>
            <div>
                <div class="text-3xl font-extrabold tracking-tight leading-none">Reportes de producción</div>
                <div class="text-sm text-secondary mt-1">Analiza la producción por departamento y proceso</div>
            </div>
        </div>
    </div>

    <!-- ===== FILTROS MÓVIL ===== -->
    <div class="md:hidden">
        <div class="sticky top-0 z-40 bg-card border-b shadow-sm">
            <div class="flex items-center gap-3 pr-4">
                <mat-form-field class="fuse-mat-dense fuse-mat-rounded-lg flex-1 border-none" appearance="outline"
                    [subscriptSizing]="'dynamic'">
                    <mat-icon matPrefix class="text-hint" [svgIcon]="'heroicons_solid:magnifying-glass'"></mat-icon>
                    <input matInput [formControl]="searchControl" [autocomplete]="'off'" placeholder="Buscar...">
                </mat-form-field>

                <button mat-icon-button color="primary" class="relative" (click)="togglePanelFiltros()"
                    [matBadge]="filtrosActivosCount()" matBadgeSize="small" matBadgeColor="accent"
                    [matBadgeHidden]="filtrosActivosCount() === 0">
                    <mat-icon [svgIcon]="'heroicons_solid:adjustments-horizontal'"></mat-icon>
                </button>
            </div>
        </div>

        <!-- Panel completo de filtros móvil -->
        <div *ngIf="mostrarPanelFiltros" class="fixed inset-0 z-50 flex flex-col bg-card">
            <div class="flex items-center justify-between p-5 border-b sticky top-0 bg-card z-10 shadow-sm">
                <h2 class="text-xl font-bold">Filtros avanzados</h2>
                <button mat-icon-button (click)="togglePanelFiltros()">
                    <mat-icon [svgIcon]="'heroicons_solid:x-mark'"></mat-icon>
                </button>
            </div>

            <div class="flex-1 overflow-y-auto p-5 space-y-6">
                <div>
                    <button mat-stroked-button class="w-full mt-15 h-14 px-5 justify-between rounded-xl border-2 
                               hover:border-primary transition-all font-medium" (click)="toggleDatePanel()">
                        <div class="flex items-center gap-3">
                            <mat-icon class="text-primary" [svgIcon]="'heroicons_solid:calendar-days'"></mat-icon>
                            <span class="truncate">{{ obtenerTextoFechaSeleccionada() }}</span>
                        </div>
                        <mat-icon [svgIcon]="'heroicons_solid:chevron-down'" class="transition-transform duration-200"
                            [ngClass]="{'rotate-180': mostrarPanelFechas}"></mat-icon>
                    </button>

                    <div *ngIf="mostrarPanelFechas"
                        class="fixed inset-4 top-20 bg-card rounded-2xl shadow-2xl border z-50 overflow-hidden flex flex-col">
                        <div class="p-5 border-b bg-card">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <mat-icon class="text-primary"
                                        [svgIcon]="'heroicons_solid:calendar-days'"></mat-icon>
                                    <h3 class="text-lg font-bold">Filtrar por fechas</h3>
                                </div>
                                <div class="flex items-center gap-3">
                                    <button mat-button color="primary" (click)="limpiarFiltroFechas()">Limpiar</button>
                                    <button mat-icon-button (click)="toggleDatePanel()">
                                        <mat-icon [svgIcon]="'heroicons_solid:x-mark'"></mat-icon>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="flex-1 overflow-y-auto p-5">
                            <div class="grid grid-cols-2 gap-3">
                                <button mat-flat-button class="h-12 rounded-xl justify-between col-span-2 border-2"
                                    [ngClass]="{
                                        'bg-primary border-primary text-white': rangoFechaSeleccionado === 'todos',
                                        'border-default': rangoFechaSeleccionado !== 'todos'
                                    }" (click)="seleccionarRangoFecha('todos')">
                                    Ver todos
                                    <mat-icon *ngIf="rangoFechaSeleccionado === 'todos'"
                                        [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                </button>

                                <button mat-flat-button class="h-12 rounded-xl justify-between border-2" [ngClass]="{
                                        'bg-primary border-primary text-white': rangoFechaSeleccionado === 'hoy',
                                        'border-default': rangoFechaSeleccionado !== 'hoy'
                                    }" (click)="seleccionarRangoFecha('hoy')">
                                    Hoy
                                    <mat-icon *ngIf="rangoFechaSeleccionado === 'hoy'"
                                        [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                </button>

                                <button mat-flat-button class="h-12 rounded-xl justify-between border-2" [ngClass]="{
                                        'bg-primary border-primary text-white': rangoFechaSeleccionado === 'ayer',
                                        'border-default': rangoFechaSeleccionado !== 'ayer'
                                    }" (click)="seleccionarRangoFecha('ayer')">
                                    Ayer
                                    <mat-icon *ngIf="rangoFechaSeleccionado === 'ayer'"
                                        [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                </button>

                                <button mat-flat-button class="h-12 rounded-xl justify-between border-2" [ngClass]="{
                                        'bg-primary border-primary text-white': rangoFechaSeleccionado === 'mes_actual',
                                        'border-default': rangoFechaSeleccionado !== 'mes_actual'
                                    }" (click)="seleccionarRangoFecha('mes_actual')">
                                    Mes actual
                                    <mat-icon *ngIf="rangoFechaSeleccionado === 'mes_actual'"
                                        [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                </button>

                                <button mat-flat-button class="h-12 rounded-xl justify-between border-2" [ngClass]="{
                                        'bg-primary border-primary text-white': rangoFechaSeleccionado === 'mes_anterior',
                                        'border-default': rangoFechaSeleccionado !== 'mes_anterior'
                                    }" (click)="seleccionarRangoFecha('mes_anterior')">
                                    Mes anterior
                                    <mat-icon *ngIf="rangoFechaSeleccionado === 'mes_anterior'"
                                        [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                </button>

                                <button mat-stroked-button class="h-12 rounded-xl border-2" [ngClass]="{
                                        'border-primary text-primary bg-primary/10': rangoFechaSeleccionado === 'fecha_especifica'
                                    }" (click)="seleccionarRangoFecha('fecha_especifica')">
                                    Fecha específica
                                </button>

                                <button mat-stroked-button class="h-12 rounded-xl border-2" [ngClass]="{
                                        'border-primary text-primary bg-primary/10': rangoFechaSeleccionado === 'periodo'
                                    }" (click)="seleccionarRangoFecha('periodo')">
                                    Periodo
                                </button>
                            </div>

                            <div *ngIf="rangoFechaSeleccionado === 'fecha_especifica'" class="mt-6 space-y-4">
                                <h4 class="font-semibold text-primary">Selecciona una fecha</h4>
                                <mat-form-field class="w-full" appearance="outline">
                                    <input matInput [matDatepicker]="pickerMovilUnica"
                                        [formControl]="fechaInicioControl">
                                    <mat-datepicker-toggle matIconSuffix
                                        [for]="pickerMovilUnica"></mat-datepicker-toggle>
                                    <mat-datepicker #pickerMovilUnica touchUi></mat-datepicker>
                                </mat-form-field>
                                <button mat-flat-button color="primary" class="w-full h-14 rounded-full text-lg"
                                    (click)="aplicarFiltroFechas()">
                                    <mat-icon class="mr-2" [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                    Aplicar
                                </button>
                            </div>

                            <div *ngIf="rangoFechaSeleccionado === 'periodo'" class="mt-6 space-y-4">
                                <h4 class="font-semibold text-primary">Rango personalizado</h4>
                                <mat-form-field class="w-full" appearance="outline">
                                    <mat-label>Fecha Desde</mat-label>
                                    <input matInput [matDatepicker]="pickerMovilInicio"
                                        [formControl]="fechaInicioControl">
                                    <mat-datepicker-toggle matIconSuffix
                                        [for]="pickerMovilInicio"></mat-datepicker-toggle>
                                    <mat-datepicker #pickerMovilInicio touchUi></mat-datepicker>
                                </mat-form-field>
                                <mat-form-field class="w-full" appearance="outline">
                                    <mat-label>Fecha Hasta</mat-label>
                                    <input matInput [matDatepicker]="pickerMovilFin" [formControl]="fechaFinControl">
                                    <mat-datepicker-toggle matIconSuffix [for]="pickerMovilFin"></mat-datepicker-toggle>
                                    <mat-datepicker #pickerMovilFin touchUi></mat-datepicker>
                                </mat-form-field>
                                <button mat-flat-button color="primary" class="w-full h-14 rounded-full text-lg"
                                    (click)="aplicarFiltroFechas()">
                                    <mat-icon class="mr-2" [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                    Aplicar rango
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <mat-form-field class="w-full" appearance="outline">
                    <mat-icon matPrefix class="text-primary" [svgIcon]="'heroicons_solid:building-office-2'"></mat-icon>
                    <mat-label>Departamento</mat-label>
                    <mat-select [formControl]="deptoControl">
                        <mat-option [value]="''">Todos los departamentos</mat-option>
                        <mat-option *ngFor="let depto of departamentosUnicos" [value]="depto">{{ depto }}</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>

            <div class="p-5 border-t bg-card space-y-3">
                <button mat-stroked-button class="w-full h-12 rounded-xl"
                    (click)="limpiarTodosFiltros(); togglePanelFiltros()">
                    Limpiar filtros
                </button>
            </div>
        </div>
    </div>

    <!-- ===== FILTROS PC ===== -->
    <div class="hidden md:block">
        <div class="flex flex-col gap-3 p-6 md:px-8 border-b bg-gray-50 dark:bg-gray-900/50">
            <div class="flex gap-3">
                <div class="relative">
                    <button mat-stroked-button class="h-10 px-4 min-w-64" (click)="toggleDatePanel()">
                        <mat-icon class="icon-size-5 mr-2" [svgIcon]="'heroicons_solid:calendar'"></mat-icon>
                        <span class="text-sm truncate">{{ obtenerTextoFechaSeleccionada() }}</span>
                        <mat-icon class="icon-size-4 ml-auto" [svgIcon]="'heroicons_solid:chevron-down'"></mat-icon>
                    </button>

                    <div *ngIf="mostrarPanelFechas"
                        class="absolute top-full left-0 mt-2 bg-card rounded-lg shadow-2xl border z-50 w-96 overflow-hidden">
                        <div class="p-4 border-b flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <mat-icon class="text-primary" [svgIcon]="'heroicons_solid:calendar'"></mat-icon>
                                <h3 class="font-semibold">Filtrar por fechas</h3>
                            </div>
                            <div class="flex gap-2">
                                <button mat-button class="text-primary" (click)="limpiarFiltroFechas()">Limpiar</button>
                                <button mat-icon-button (click)="toggleDatePanel()">
                                    <mat-icon [svgIcon]="'heroicons_solid:x-mark'"></mat-icon>
                                </button>
                            </div>
                        </div>

                        <div class="p-4">
                            <div class="grid grid-cols-2 gap-2">
                                <button mat-flat-button class="h-12 rounded-lg col-span-2 border-2" [ngClass]="{
                                        'bg-primary border-primary text-white': rangoFechaSeleccionado === 'todos'
                                    }" (click)="seleccionarRangoFecha('todos')">
                                    <span class="flex-1 text-left">Ver todos</span>
                                    <mat-icon *ngIf="rangoFechaSeleccionado === 'todos'"
                                        [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                </button>

                                <button mat-button class="h-12 rounded-lg border-2" [ngClass]="{
                                        'bg-primary border-primary text-white': rangoFechaSeleccionado === 'hoy'
                                    }" (click)="seleccionarRangoFecha('hoy')">
                                    <span class="flex-1 text-left">Hoy</span>
                                    <mat-icon *ngIf="rangoFechaSeleccionado === 'hoy'"
                                        [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                </button>

                                <button mat-button class="h-12 rounded-lg border-2" [ngClass]="{
                                        'bg-primary border-primary text-white': rangoFechaSeleccionado === 'ayer'
                                    }" (click)="seleccionarRangoFecha('ayer')">
                                    <span class="flex-1 text-left">Ayer</span>
                                    <mat-icon *ngIf="rangoFechaSeleccionado === 'ayer'"
                                        [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                </button>

                                <button mat-button class="h-12 rounded-lg border-2" [ngClass]="{
                                        'bg-primary border-primary text-white': rangoFechaSeleccionado === 'mes_actual'
                                    }" (click)="seleccionarRangoFecha('mes_actual')">
                                    <span class="flex-1 text-left">Mes actual</span>
                                    <mat-icon *ngIf="rangoFechaSeleccionado === 'mes_actual'"
                                        [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                </button>

                                <button mat-button class="h-12 rounded-lg border-2" [ngClass]="{
                                        'bg-primary border-primary text-white': rangoFechaSeleccionado === 'mes_anterior'
                                    }" (click)="seleccionarRangoFecha('mes_anterior')">
                                    <span class="flex-1 text-left">Mes anterior</span>
                                    <mat-icon *ngIf="rangoFechaSeleccionado === 'mes_anterior'"
                                        [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                </button>

                                <button mat-button class="h-12 rounded-lg border-2" [ngClass]="{
                                        'border-primary text-primary': rangoFechaSeleccionado === 'fecha_especifica'
                                    }" (click)="seleccionarRangoFecha('fecha_especifica')">
                                    Fecha específica
                                </button>

                                <button mat-button class="h-12 rounded-lg border-2" [ngClass]="{
                                        'border-primary text-primary': rangoFechaSeleccionado === 'periodo'
                                    }" (click)="seleccionarRangoFecha('periodo')">
                                    Periodo
                                </button>
                            </div>
                        </div>

                        <div *ngIf="rangoFechaSeleccionado === 'fecha_especifica'"
                            class="p-4 border-t bg-gray-50 dark:bg-gray-900">
                            <h4 class="text-sm font-medium mb-3">Selecciona una fecha</h4>
                            <mat-form-field class="w-full">
                                <input matInput [matDatepicker]="pickerPcUnica" [formControl]="fechaInicioControl">
                                <mat-datepicker-toggle matIconSuffix [for]="pickerPcUnica"></mat-datepicker-toggle>
                                <mat-datepicker #pickerPcUnica></mat-datepicker>
                            </mat-form-field>
                            <button mat-flat-button color="primary" class="w-full" (click)="aplicarFiltroFechas()">
                                Aplicar
                            </button>
                        </div>

                        <div *ngIf="rangoFechaSeleccionado === 'periodo'"
                            class="p-4 border-t bg-gray-50 dark:bg-gray-900">
                            <h4 class="text-sm font-medium mb-3">Rango personalizado</h4>
                            <mat-form-field class="w-full">
                                <mat-label>Fecha Desde</mat-label>
                                <input matInput [matDatepicker]="pickerPcInicio" [formControl]="fechaInicioControl">
                                <mat-datepicker-toggle matIconSuffix [for]="pickerPcInicio"></mat-datepicker-toggle>
                                <mat-datepicker #pickerPcInicio></mat-datepicker>
                            </mat-form-field>
                            <mat-form-field class="w-full">
                                <mat-label>Fecha Hasta</mat-label>
                                <input matInput [matDatepicker]="pickerPcFin" [formControl]="fechaFinControl">
                                <mat-datepicker-toggle matIconSuffix [for]="pickerPcFin"></mat-datepicker-toggle>
                                <mat-datepicker #pickerPcFin></mat-datepicker>
                            </mat-form-field>
                            <button mat-flat-button color="primary" class="w-full" (click)="aplicarFiltroFechas()">
                                Aplicar rango
                            </button>
                        </div>
                    </div>
                </div>

                <mat-form-field class="fuse-mat-dense fuse-mat-rounded flex-1">
                    <mat-icon matPrefix [svgIcon]="'heroicons_solid:magnifying-glass'"></mat-icon>
                    <input matInput [formControl]="searchControl" placeholder="Buscar...">
                </mat-form-field>
            </div>

            <div class="flex gap-3">
                <mat-form-field class="fuse-mat-dense fuse-mat-rounded flex-1">
                    <mat-icon matPrefix [svgIcon]="'heroicons_solid:building-office'"></mat-icon>
                    <mat-select [formControl]="deptoControl" placeholder="Departamento">
                        <mat-option [value]="''">Todos</mat-option>
                        <mat-option *ngFor="let depto of departamentosUnicos" [value]="depto">{{ depto }}</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
        </div>

        <div *ngIf="mostrarPanelFechas" class="fixed inset-0 bg-black/30 z-40" (click)="toggleDatePanel()"></div>
    </div>

    <!-- ===== CONTENIDO PRINCIPAL ===== -->
    <div class="flex flex-auto overflow-hidden">
        <div class="flex flex-col flex-auto overflow-y-auto">

            <!-- Empty state -->
            <ng-container *ngIf="!isLoading && datosFiltrados.length === 0">
                <div class="flex flex-col items-center justify-center flex-auto p-8">
                    <div
                        class="flex items-center justify-center w-24 h-24 rounded-full bg-gray-100 dark:bg-gray-800 mb-6">
                        <mat-icon class="icon-size-16 text-hint" [svgIcon]="'heroicons_outline:inbox'"></mat-icon>
                    </div>
                    <div class="text-2xl font-semibold tracking-tight mb-2">Sin datos de producción</div>
                    <div class="text-md text-secondary text-center max-w-md">
                        No se encontraron registros con los filtros seleccionados.
                    </div>
                </div>
            </ng-container>

            <!-- Contenido con datos -->
            <ng-container *ngIf="!isLoading && datosFiltrados.length > 0">

                <!-- Tabla con Tabs -->
                <div class="overflow-x-auto px-1 md:px-8 pb-6">
                    <mat-tab-group animationDuration="300ms" [disableRipple]="true">

                        <!-- ========== TAB 1: PROCESOS ========== -->
                        <mat-tab>
                            <ng-template mat-tab-label>
                                <mat-icon class="icon-size-5 mr-2"
                                    [svgIcon]="'heroicons_solid:building-office'"></mat-icon>
                                <span class="font-medium">Procesos</span>
                            </ng-template>

                            <!-- Tarjetas de resumen -->
                            <div class="px-4 py-3 md:px-8 md:py-4 mt-3">
                                <!-- Card móvil -->
                                <div class="md:hidden">
                                    <div class="bg-card shadow-sm rounded-lg px-4 py-2 border-l-4 border-green-500">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <div class="text-sm font-medium text-secondary mb-1">Cantidad Total
                                                </div>
                                                <div class="text-2xl font-bold">{{ calcularCantidadTotal() |
                                                    number:'1.0-0' }}</div>
                                                <div class="text-xs text-secondary mt-1">kilogramos</div>
                                            </div>
                                            <mat-icon class="text-green-500 icon-size-8"
                                                [svgIcon]="'heroicons_solid:scale'"></mat-icon>
                                        </div>
                                    </div>
                                </div>

                                <!-- Cards desktop -->
                                <div class="hidden md:grid grid-cols-3 gap-3">
                                    <div class="bg-card shadow-sm rounded-xl p-4 border-l-4 border-green-500">
                                        <div class="flex items-center justify-between mb-1">
                                            <div class="text-sm font-medium text-secondary">Cantidad Total</div>
                                            <mat-icon class="text-green-500 icon-size-5"
                                                [svgIcon]="'heroicons_solid:scale'"></mat-icon>
                                        </div>
                                        <div class="text-2xl font-bold">{{ calcularCantidadTotal() | number:'1.0-0' }}
                                        </div>
                                        <div class="text-xs text-secondary">kilogramos</div>
                                    </div>

                                    <div class="bg-card shadow-sm rounded-xl p-4 border-l-4 border-blue-500">
                                        <div class="flex items-center justify-between mb-1">
                                            <div class="text-sm font-medium text-secondary">Total Registros</div>
                                            <mat-icon class="text-blue-500 icon-size-5"
                                                [svgIcon]="'heroicons_solid:document-text'"></mat-icon>
                                        </div>
                                        <div class="text-2xl font-bold">{{ datosFiltrados.length }}</div>
                                        <div class="text-xs text-secondary">reportes</div>
                                    </div>

                                    <div class="bg-card shadow-sm rounded-xl p-4 border-l-4 border-purple-500">
                                        <div class="flex items-center justify-between mb-1">
                                            <div class="text-sm font-medium text-secondary">Departamentos</div>
                                            <mat-icon class="text-purple-500 icon-size-5"
                                                [svgIcon]="'heroicons_solid:building-office'"></mat-icon>
                                        </div>
                                        <div class="text-2xl font-bold">{{ contarDepartamentos() }}</div>
                                        <div class="text-xs text-secondary">áreas activas</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tabla -->
                            <div class="mt-6 overflow-x-auto px-4 md:px-8">
                                <table class="w-full bg-card shadow-sm rounded-2xl overflow-hidden">
                                    <thead class="bg-gray-50 dark:bg-gray-800">
                                        <tr>
                                            <th
                                                class="px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider">
                                                Departamento
                                            </th>
                                            <th
                                                class="px-6 py-4 text-right text-xs font-semibold uppercase tracking-wider">
                                                Cantidad (kg)
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y">
                                        <ng-container *ngFor="let grupo of datosAgrupados; let i = index">
                                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors cursor-pointer"
                                                (click)="toggleDepartamento(i)">
                                                <td class="px-6 py-4">
                                                    <div class="flex items-center gap-3">
                                                        <mat-icon class="icon-size-4 transition-transform"
                                                            [ngClass]="{'rotate-90': grupo.expandido}"
                                                            [svgIcon]="'heroicons_solid:chevron-right'"></mat-icon>
                                                        <mat-icon class="icon-size-5 text-blue-500"
                                                            [svgIcon]="'heroicons_solid:building-office'"></mat-icon>
                                                        <div>
                                                            <div class="font-semibold">{{ grupo.departamento }}</div>
                                                            <div class="text-xs text-secondary">{{ grupo.procesos.length
                                                                }} procesos</div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 text-right">
                                                    <span class="font-bold text-green-600 dark:text-green-400 text-lg">
                                                        {{ grupo.cantidadTotal | number:'1.2-2' }}
                                                    </span>
                                                </td>
                                            </tr>
                                            <tr *ngFor="let proceso of grupo.procesos"
                                                [style.display]="grupo.expandido ? 'table-row' : 'none'"
                                                class="bg-gray-50 dark:bg-gray-800/50">
                                                <td class="px-6 py-3 pl-20">
                                                    <div class="flex items-center gap-3">
                                                        <mat-icon class="icon-size-4 text-gray-400"
                                                            [svgIcon]="'heroicons_solid:cog-8-tooth'"></mat-icon>
                                                        <span class="text-sm text-secondary">{{ proceso.proceso
                                                            }}</span>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-3 text-right">
                                                    <span
                                                        class="text-sm font-medium text-green-600 dark:text-green-400">
                                                        {{ proceso.cantidad | number:'1.2-2' }}
                                                    </span>
                                                </td>
                                            </tr>
                                        </ng-container>
                                    </tbody>
                                    <tfoot class="bg-gray-50 dark:bg-gray-800 font-bold border-t-2">
                                        <tr>
                                            <td class="px-6 py-4 text-right uppercase text-sm">Total General:</td>
                                            <td class="px-6 py-4 text-right">
                                                <span class="text-lg text-green-600 dark:text-green-400">
                                                    {{ calcularCantidadTotal() | number:'1.2-2' }}
                                                </span>
                                            </td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </mat-tab>

                        <!-- ========== TAB 2: PRODUCCIÓN DE TEJIDO ========== -->
                        <mat-tab>
                            <ng-template mat-tab-label>
                                <mat-icon class="icon-size-5 mr-2" [svgIcon]="'heroicons_solid:cog-8-tooth'"></mat-icon>
                                <span class="font-medium">Producción de Tejido</span>
                            </ng-template>

                            <!-- Cards de resumen para Tejido -->
                            <div class="px-4 py-3 md:px-8 md:py-4 mt-3">
                                <!-- Vista móvil -->
                                <div class="md:hidden">
                                    <div class="bg-card shadow-sm rounded-lg px-4 py-2 border-l-4 border-indigo-500">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <div class="text-sm font-medium text-secondary mb-1">Total Tejido</div>
                                                <div class="text-2xl font-bold">{{ calcularTotalPesoTejido() |
                                                    number:'1.0-0' }}</div>
                                                <div class="text-xs text-secondary mt-1">kilogramos</div>
                                            </div>
                                            <mat-icon class="text-indigo-500 icon-size-8"
                                                [svgIcon]="'heroicons_solid:cog-8-tooth'"></mat-icon>
                                        </div>
                                    </div>
                                </div>

                                <!-- Vista desktop -->
                                <div class="hidden md:grid grid-cols-3 gap-3">
                                    <div class="bg-card shadow-sm rounded-xl p-4 border-l-4 border-indigo-500">
                                        <div class="flex items-center justify-between mb-1">
                                            <div class="text-sm font-medium text-secondary">Total Tejido</div>
                                            <mat-icon class="text-indigo-500 icon-size-5"
                                                [svgIcon]="'heroicons_solid:scale'"></mat-icon>
                                        </div>
                                        <div class="text-2xl font-bold">{{ calcularTotalPesoTejido() | number:'1.0-0' }}
                                        </div>
                                        <div class="text-xs text-secondary">kilogramos</div>
                                    </div>

                                    <div class="bg-card shadow-sm rounded-xl p-4 border-l-4 border-blue-500">
                                        <div class="flex items-center justify-between mb-1">
                                            <div class="text-sm font-medium text-secondary">Total Artículos</div>
                                            <mat-icon class="text-blue-500 icon-size-5"
                                                [svgIcon]="'heroicons_solid:cube'"></mat-icon>
                                        </div>
                                        <div class="text-2xl font-bold">{{ contarArticulosTejido() }}</div>
                                        <div class="text-xs text-secondary">artículos procesados</div>
                                    </div>

                                    <div class="bg-card shadow-sm rounded-xl p-4 border-l-4 border-purple-500">
                                        <div class="flex items-center justify-between mb-1">
                                            <div class="text-sm font-medium text-secondary">Total Piezas</div>
                                            <mat-icon class="text-purple-500 icon-size-5"
                                                [svgIcon]="'heroicons_solid:chart-bar'"></mat-icon>
                                        </div>
                                        <div class="text-2xl font-bold">{{ calcularTotalPiezasTejido() | number:'1.0-0'
                                            }}</div>
                                        <div class="text-xs text-secondary">piezas producidas</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tabla de datos -->
                            <div class="mt-6 overflow-x-auto px-4 md:px-8">
                                <div *ngIf="isLoadingTejido" class="p-8 text-center">
                                    <mat-spinner diameter="40" class="mx-auto"></mat-spinner>
                                    <p class="mt-4 text-secondary">Cargando datos de tejido...</p>
                                </div>

                                <table *ngIf="!isLoadingTejido && datosTejidoFiltrados.length > 0"
                                    class="w-full bg-card shadow-sm rounded-2xl overflow-hidden">
                                    <thead class="bg-gray-50 dark:bg-gray-800">
                                        <tr>
                                            <th
                                                class="px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider">
                                                Artículo
                                            </th>
                                            <th
                                                class="px-6 py-4 text-right text-xs font-semibold uppercase tracking-wider">
                                                Piezas
                                            </th>
                                            <th
                                                class="px-6 py-4 text-right text-xs font-semibold uppercase tracking-wider">
                                                Peso Tejido (kg)
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y">
                                        <tr *ngFor="let item of datosTejidoFiltrados"
                                            class="hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                                            <td class="px-6 py-4">
                                                <div class="flex items-center gap-3">
                                                    <mat-icon class="icon-size-5 text-indigo-500"
                                                        [svgIcon]="'heroicons_solid:cube'"></mat-icon>
                                                    <span class="font-medium">{{ item.ARTICULO }}</span>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 text-right">
                                                <span class="font-medium">{{ item.PIEZAS | number:'1.0-0' }}</span>
                                            </td>
                                            <td class="px-6 py-4 text-right">
                                                <span class="font-semibold text-indigo-600 dark:text-indigo-400">
                                                    {{ item.TOTAL_TJ | number:'1.2-2' }}
                                                </span>
                                            </td>
                                        </tr>
                                    </tbody>
                                    <tfoot class="bg-gray-50 dark:bg-gray-800 font-bold border-t-2">
                                        <tr>
                                            <td class="px-6 py-4 uppercase text-sm">Total:</td>
                                            <td class="px-6 py-4 text-right">
                                                <span class="text-lg text-purple-600 dark:text-purple-400">
                                                    {{ calcularTotalPiezasTejido() | number:'1.0-0' }}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 text-right">
                                                <span class="text-lg text-indigo-600 dark:text-indigo-400">
                                                    {{ calcularTotalPesoTejido() | number:'1.2-2' }}
                                                </span>
                                            </td>
                                        </tr>
                                    </tfoot>
                                </table>

                                <div *ngIf="!isLoadingTejido && datosTejidoFiltrados.length === 0"
                                    class="p-8 text-center text-secondary">
                                    <mat-icon class="icon-size-16 mb-4"
                                        [svgIcon]="'heroicons_outline:inbox'"></mat-icon>
                                    <p class="text-lg">No hay datos de producción de tejido</p>
                                </div>
                            </div>
                        </mat-tab>

                        <!-- ========== TAB 3: REVISADO DE TEJIDO ========== -->
                        <mat-tab>
                            <ng-template mat-tab-label>
                                <mat-icon class="icon-size-5 mr-2"
                                    [svgIcon]="'heroicons_solid:clipboard-document-check'"></mat-icon>
                                <span class="font-medium">Revisado de Tejido</span>
                            </ng-template>

                            <!-- Cards de resumen para Revisado -->
                            <div class="px-4 py-3 md:px-8 md:py-4 mt-3">
                                <!-- Vista móvil -->
                                <div class="md:hidden">
                                    <div class="bg-card shadow-sm rounded-lg px-4 py-2 border-l-4 border-teal-500">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <div class="text-sm font-medium text-secondary mb-1">Total Revisado
                                                </div>
                                                <div class="text-2xl font-bold">{{ calcularTotalPesoRevisado() |
                                                    number:'1.0-0' }}</div>
                                                <div class="text-xs text-secondary mt-1">kilogramos</div>
                                            </div>
                                            <mat-icon class="text-teal-500 icon-size-8"
                                                [svgIcon]="'heroicons_solid:clipboard-document-check'"></mat-icon>
                                        </div>
                                    </div>
                                </div>

                                <!-- Vista desktop -->
                                <div class="hidden md:grid grid-cols-3 gap-3">
                                    <div class="bg-card shadow-sm rounded-xl p-4 border-l-4 border-teal-500">
                                        <div class="flex items-center justify-between mb-1">
                                            <div class="text-sm font-medium text-secondary">Total Revisado</div>
                                            <mat-icon class="text-teal-500 icon-size-5"
                                                [svgIcon]="'heroicons_solid:scale'"></mat-icon>
                                        </div>
                                        <div class="text-2xl font-bold">{{ calcularTotalPesoRevisado() | number:'1.0-0'
                                            }}</div>
                                        <div class="text-xs text-secondary">kilogramos</div>
                                    </div>

                                    <div class="bg-card shadow-sm rounded-xl p-4 border-l-4 border-blue-500">
                                        <div class="flex items-center justify-between mb-1">
                                            <div class="text-sm font-medium text-secondary">Total Artículos</div>
                                            <mat-icon class="text-blue-500 icon-size-5"
                                                [svgIcon]="'heroicons_solid:clipboard-document-check'"></mat-icon>
                                        </div>
                                        <div class="text-2xl font-bold">{{ contarArticulosRevisado() }}</div>
                                        <div class="text-xs text-secondary">artículos revisados</div>
                                    </div>

                                    <div class="bg-card shadow-sm rounded-xl p-4 border-l-4 border-purple-500">
                                        <div class="flex items-center justify-between mb-1">
                                            <div class="text-sm font-medium text-secondary">Total Piezas</div>
                                            <mat-icon class="text-purple-500 icon-size-5"
                                                [svgIcon]="'heroicons_solid:chart-bar'"></mat-icon>
                                        </div>
                                        <div class="text-2xl font-bold">{{ calcularTotalPiezasRevisado() |
                                            number:'1.0-0' }}</div>
                                        <div class="text-xs text-secondary">piezas revisadas</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tabla de datos -->
                            <div class="mt-6 overflow-x-auto px-4 md:px-8">
                                <div *ngIf="isLoadingRevisado" class="p-8 text-center">
                                    <mat-spinner diameter="40" class="mx-auto"></mat-spinner>
                                    <p class="mt-4 text-secondary">Cargando datos de revisión...</p>
                                </div>

                                <table *ngIf="!isLoadingRevisado && datosRevisadoFiltrados.length > 0"
                                    class="w-full bg-card shadow-sm rounded-2xl overflow-hidden">
                                    <thead class="bg-gray-50 dark:bg-gray-800">
                                        <tr>
                                            <th
                                                class="px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider">
                                                Artículo
                                            </th>
                                            <th
                                                class="px-6 py-4 text-right text-xs font-semibold uppercase tracking-wider">
                                                Piezas
                                            </th>
                                            <th
                                                class="px-6 py-4 text-right text-xs font-semibold uppercase tracking-wider">
                                                Peso Revisado (kg)
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y">
                                        <tr *ngFor="let item of datosRevisadoFiltrados"
                                            class="hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                                            <td class="px-6 py-4">
                                                <div class="flex items-center gap-3">
                                                    <mat-icon class="icon-size-5 text-teal-500"
                                                        [svgIcon]="'heroicons_solid:clipboard-document-check'"></mat-icon>
                                                    <span class="font-medium">{{ item.ARTICULO }}</span>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 text-right">
                                                <span class="font-medium">{{ item.PIEZAS | number:'1.0-0' }}</span>
                                            </td>
                                            <td class="px-6 py-4 text-right">
                                                <span class="font-semibold text-teal-600 dark:text-teal-400">
                                                    {{ item.TOTAL_RV | number:'1.2-2' }}
                                                </span>
                                            </td>
                                        </tr>
                                    </tbody>
                                    <tfoot class="bg-gray-50 dark:bg-gray-800 font-bold border-t-2">
                                        <tr>
                                            <td class="px-6 py-4 uppercase text-sm">Total:</td>
                                            <td class="px-6 py-4 text-right">
                                                <span class="text-lg text-purple-600 dark:text-purple-400">
                                                    {{ calcularTotalPiezasRevisado() | number:'1.0-0' }}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 text-right">
                                                <span class="text-lg text-teal-600 dark:text-teal-400">
                                                    {{ calcularTotalPesoRevisado() | number:'1.2-2' }}
                                                </span>
                                            </td>
                                        </tr>
                                    </tfoot>
                                </table>

                                <div *ngIf="!isLoadingRevisado && datosRevisadoFiltrados.length === 0"
                                    class="p-8 text-center text-secondary">
                                    <mat-icon class="icon-size-16 mb-4"
                                        [svgIcon]="'heroicons_outline:inbox'"></mat-icon>
                                    <p class="text-lg">No hay datos de revisión de tejido</p>
                                </div>
                            </div>
                        </mat-tab>

                        <!-- ========== TAB 4: POR REVISAR ========== -->
<mat-tab>
    <ng-template mat-tab-label>
        <mat-icon class="icon-size-5 mr-2" [svgIcon]="'heroicons_solid:x-circle'"></mat-icon>
        <span class="font-medium">Por revisar</span>
    </ng-template>

    <!-- Cards de resumen -->
    <div class="px-4 py-3 md:px-8 md:py-4 mt-3">
        <!-- Vista móvil -->
        <div class="md:hidden">
            <div class="bg-card shadow-sm rounded-lg px-4 py-2 border-l-4 border-amber-500">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="text-sm font-medium text-secondary mb-1">Total Por Revisar</div>
                        <div class="text-2xl font-bold">{{ calcularTotalPesoPorRevisar() | number:'1.0-0' }}</div>
                        <div class="text-xs text-secondary mt-1">kilogramos</div>
                    </div>
                    <mat-icon class="text-amber-500 icon-size-8"
                        [svgIcon]="'heroicons_solid:x-circle'"></mat-icon>
                </div>
            </div>
        </div>

        <!-- Vista desktop -->
        <div class="hidden md:grid grid-cols-3 gap-3">
            <div class="bg-card shadow-sm rounded-xl p-4 border-l-4 border-amber-500">
                <div class="flex items-center justify-between mb-1">
                    <div class="text-sm font-medium text-secondary">Total Por Revisar</div>
                    <mat-icon class="text-amber-500 icon-size-5"
                        [svgIcon]="'heroicons_solid:scale'"></mat-icon>
                </div>
                <div class="text-2xl font-bold">{{ calcularTotalPesoPorRevisar() | number:'1.0-0' }}</div>
                <div class="text-xs text-secondary">kilogramos</div>
            </div>

            <div class="bg-card shadow-sm rounded-xl p-4 border-l-4 border-blue-500">
                <div class="flex items-center justify-between mb-1">
                    <div class="text-sm font-medium text-secondary">Total Artículos</div>
                    <mat-icon class="text-blue-500 icon-size-5"
                        [svgIcon]="'heroicons_solid:cube'"></mat-icon>
                </div>
                <div class="text-2xl font-bold">{{ contarArticulosPorRevisar() }}</div>
                <div class="text-xs text-secondary">artículos pendientes</div>
            </div>

            <div class="bg-card shadow-sm rounded-xl p-4 border-l-4 border-purple-500">
                <div class="flex items-center justify-between mb-1">
                    <div class="text-sm font-medium text-secondary">Total Piezas</div>
                    <mat-icon class="text-purple-500 icon-size-5"
                        [svgIcon]="'heroicons_solid:chart-bar'"></mat-icon>
                </div>
                <div class="text-2xl font-bold">{{ calcularTotalPiezasPorRevisar() | number:'1.0-0' }}</div>
                <div class="text-xs text-secondary">piezas pendientes</div>
            </div>
        </div>
    </div>

    <!-- Tabla de datos -->
    <div class="mt-6 overflow-x-auto px-4 md:px-8">
        <div *ngIf="isLoadingPorRevisar" class="p-8 text-center">
            <mat-spinner diameter="40" class="mx-auto"></mat-spinner>
            <p class="mt-4 text-secondary">Cargando datos por revisar...</p>
        </div>

        <table *ngIf="!isLoadingPorRevisar && datosPorRevisarFiltrados.length > 0"
            class="w-full bg-card shadow-sm rounded-2xl overflow-hidden">
            <thead class="bg-gray-50 dark:bg-gray-800">
                <tr>
                    <th class="px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider">
                        Artículo
                    </th>
                    <th class="px-6 py-4 text-right text-xs font-semibold uppercase tracking-wider">
                        Piezas
                    </th>
                    <th class="px-6 py-4 text-right text-xs font-semibold uppercase tracking-wider">
                        Peso Por Revisar (kg)
                    </th>
                </tr>
            </thead>
            <tbody class="divide-y">
                <tr *ngFor="let item of datosPorRevisarFiltrados"
                    class="hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-3">
                            <mat-icon class="icon-size-5 text-amber-500"
                                [svgIcon]="'heroicons_solid:x-circle'"></mat-icon>
                            <span class="font-medium">{{ item.ARTICULO }}</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 text-right">
                        <span class="font-medium">{{ item.PIEZAS | number:'1.0-0' }}</span>
                    </td>
                    <td class="px-6 py-4 text-right">
                        <span class="font-semibold text-amber-600 dark:text-amber-400">
                            {{ item.TOTAL_POR_REVISAR | number:'1.2-2' }}
                        </span>
                    </td>
                </tr>
            </tbody>
            <tfoot class="bg-gray-50 dark:bg-gray-800 font-bold border-t-2">
                <tr>
                    <td class="px-6 py-4 uppercase text-sm">Total:</td>
                    <td class="px-6 py-4 text-right">
                        <span class="text-lg text-purple-600 dark:text-purple-400">
                            {{ calcularTotalPiezasPorRevisar() | number:'1.0-0' }}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-right">
                        <span class="text-lg text-amber-600 dark:text-amber-400">
                            {{ calcularTotalPesoPorRevisar() | number:'1.2-2' }}
                        </span>
                    </td>
                </tr>
            </tfoot>
        </table>

        <div *ngIf="!isLoadingPorRevisar && datosPorRevisarFiltrados.length === 0"
            class="p-8 text-center text-secondary">
            <mat-icon class="icon-size-16 mb-4"
                [svgIcon]="'heroicons_outline:x-circle'"></mat-icon>
            <p class="text-lg font-medium mb-2">Sin datos por revisar</p>
            <p class="text-sm">No hay artículos pendientes de revisión</p>
        </div>
    </div>
</mat-tab>

<!-- ========== TAB 5: SALDOS ========== -->
<mat-tab>
    <ng-template mat-tab-label>
        <mat-icon class="icon-size-5 mr-2" [svgIcon]="'heroicons_solid:currency-dollar'"></mat-icon>
        <span class="font-medium">Saldos</span>
    </ng-template>

    <!-- Cards de resumen -->
    <div class="px-4 py-3 md:px-8 md:py-4 mt-3">
        <!-- Vista móvil -->
        <div class="md:hidden">
            <div class="bg-card shadow-sm rounded-lg px-4 py-2 border-l-4 border-emerald-500">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="text-sm font-medium text-secondary mb-1">Total Saldos</div>
                        <div class="text-2xl font-bold">{{ calcularTotalPesoSaldos() | number:'1.0-0' }}</div>
                        <div class="text-xs text-secondary mt-1">kilogramos</div>
                    </div>
                    <mat-icon class="text-emerald-500 icon-size-8"
                        [svgIcon]="'heroicons_solid:currency-dollar'"></mat-icon>
                </div>
            </div>
        </div>

        <!-- Vista desktop -->
        <div class="hidden md:grid grid-cols-3 gap-3">
            <div class="bg-card shadow-sm rounded-xl p-4 border-l-4 border-emerald-500">
                <div class="flex items-center justify-between mb-1">
                    <div class="text-sm font-medium text-secondary">Total Saldos</div>
                    <mat-icon class="text-emerald-500 icon-size-5"
                        [svgIcon]="'heroicons_solid:scale'"></mat-icon>
                </div>
                <div class="text-2xl font-bold">{{ calcularTotalPesoSaldos() | number:'1.0-0' }}</div>
                <div class="text-xs text-secondary">kilogramos</div>
            </div>

            <div class="bg-card shadow-sm rounded-xl p-4 border-l-4 border-blue-500">
                <div class="flex items-center justify-between mb-1">
                    <div class="text-sm font-medium text-secondary">Total Artículos</div>
                    <mat-icon class="text-blue-500 icon-size-5"
                        [svgIcon]="'heroicons_solid:cube'"></mat-icon>
                </div>
                <div class="text-2xl font-bold">{{ contarArticulosSaldos() }}</div>
                <div class="text-xs text-secondary">artículos con saldo</div>
            </div>

            <div class="bg-card shadow-sm rounded-xl p-4 border-l-4 border-purple-500">
                <div class="flex items-center justify-between mb-1">
                    <div class="text-sm font-medium text-secondary">Total Piezas</div>
                    <mat-icon class="text-purple-500 icon-size-5"
                        [svgIcon]="'heroicons_solid:chart-bar'"></mat-icon>
                </div>
                <div class="text-2xl font-bold">{{ calcularTotalPiezasSaldos() | number:'1.0-0' }}</div>
                <div class="text-xs text-secondary">piezas en saldo</div>
            </div>
        </div>
    </div>

    <!-- Tabla de datos -->
    <div class="mt-6 overflow-x-auto px-4 md:px-8">
        <div *ngIf="isLoadingSaldos" class="p-8 text-center">
            <mat-spinner diameter="40" class="mx-auto"></mat-spinner>
            <p class="mt-4 text-secondary">Cargando datos de saldos...</p>
        </div>

        <table *ngIf="!isLoadingSaldos && datosSaldosFiltrados.length > 0"
            class="w-full bg-card shadow-sm rounded-2xl overflow-hidden">
            <thead class="bg-gray-50 dark:bg-gray-800">
                <tr>
                    <th class="px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider">
                        Artículo
                    </th>
                    <th class="px-6 py-4 text-right text-xs font-semibold uppercase tracking-wider">
                        Piezas
                    </th>
                    <th class="px-6 py-4 text-right text-xs font-semibold uppercase tracking-wider">
                        Peso Saldo (kg)
                    </th>
                </tr>
            </thead>
            <tbody class="divide-y">
                <tr *ngFor="let item of datosSaldosFiltrados"
                    class="hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-3">
                            <mat-icon class="icon-size-5 text-emerald-500"
                                [svgIcon]="'heroicons_solid:currency-dollar'"></mat-icon>
                            <span class="font-medium">{{ item.ARTICULO }}</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 text-right">
                        <span class="font-medium">{{ item.PIEZAS | number:'1.0-0' }}</span>
                    </td>
                    <td class="px-6 py-4 text-right">
                        <span class="font-semibold text-emerald-600 dark:text-emerald-400">
                            {{ item.TOTAL_SALDO | number:'1.2-2' }}
                        </span>
                    </td>
                </tr>
            </tbody>
            <tfoot class="bg-gray-50 dark:bg-gray-800 font-bold border-t-2">
                <tr>
                    <td class="px-6 py-4 uppercase text-sm">Total:</td>
                    <td class="px-6 py-4 text-right">
                        <span class="text-lg text-purple-600 dark:text-purple-400">
                            {{ calcularTotalPiezasSaldos() | number:'1.0-0' }}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-right">
                        <span class="text-lg text-emerald-600 dark:text-emerald-400">
                            {{ calcularTotalPesoSaldos() | number:'1.2-2' }}
                        </span>
                    </td>
                </tr>
            </tfoot>
        </table>

        <div *ngIf="!isLoadingSaldos && datosSaldosFiltrados.length === 0"
            class="p-8 text-center text-secondary">
            <mat-icon class="icon-size-16 mb-4"
                [svgIcon]="'heroicons_outline:currency-dollar'"></mat-icon>
            <p class="text-lg font-medium mb-2">Sin saldos</p>
            <p class="text-sm">No hay artículos con saldo pendiente</p>
        </div>
    </div>
</mat-tab>

<!-- ========== TAB 6: EMBARQUES ========== -->
<mat-tab>
    <ng-template mat-tab-label>
        <mat-icon class="icon-size-5 mr-2" [svgIcon]="'heroicons_solid:truck'"></mat-icon>
        <span class="font-medium">Entregado a Embarques</span>
    </ng-template>

    <!-- Cards de resumen por tipo -->
    <div class="px-4 py-3 md:px-8 md:py-4 mt-3">
        <!-- Vista móvil - Card único con total -->
        <div class="md:hidden">
            <div class="bg-card shadow-sm rounded-lg px-4 py-2 border-l-4 border-cyan-500">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="text-sm font-medium text-secondary mb-1">Total Embarques</div>
                        <div class="text-2xl font-bold">{{ calcularTotalEmbarques() | number:'1.0-0' }}</div>
                        <div class="text-xs text-secondary mt-1">kilogramos</div>
                    </div>
                    <mat-icon class="text-cyan-500 icon-size-8"
                        [svgIcon]="'heroicons_solid:truck'"></mat-icon>
                </div>
            </div>
        </div>

        <!-- Vista desktop - Grid de 7 cards (6 tipos + 1 total) -->
        <div class="hidden md:block">
            <!-- Primera fila: 4 cards -->
            <div class="grid grid-cols-4 gap-3 mb-3">
                <!-- PRIMERA -->
                <div class="bg-card shadow-sm rounded-xl p-4 border-l-4 border-blue-500">
                    <div class="flex items-center justify-between mb-1">
                        <div class="text-sm font-medium text-secondary">Primera</div>
                        <mat-icon class="text-blue-500 icon-size-5"
                            [svgIcon]="'heroicons_solid:star'"></mat-icon>
                    </div>
                    <div class="text-2xl font-bold">{{ calcularPorTipo('PRIMERA') | number:'1.0-0' }}</div>
                    <div class="text-xs text-secondary">kg</div>
                </div>

                <!-- PREFERIDA -->
                <div class="bg-card shadow-sm rounded-xl p-4 border-l-4 border-indigo-500">
                    <div class="flex items-center justify-between mb-1">
                        <div class="text-sm font-medium text-secondary">Preferida</div>
                        <mat-icon class="text-indigo-500 icon-size-5"
                            [svgIcon]="'heroicons_solid:heart'"></mat-icon>
                    </div>
                    <div class="text-2xl font-bold">{{ calcularPorTipo('PREFERIDA') | number:'1.0-0' }}</div>
                    <div class="text-xs text-secondary">kg</div>
                </div>

                <!-- SEGUNDA -->
                <div class="bg-card shadow-sm rounded-xl p-4 border-l-4 border-orange-500">
                    <div class="flex items-center justify-between mb-1">
                        <div class="text-sm font-medium text-secondary">Segunda</div>
                        <mat-icon class="text-orange-500 icon-size-5"
                            [svgIcon]="'heroicons_solid:chevron-double-down'"></mat-icon>
                    </div>
                    <div class="text-2xl font-bold">{{ calcularPorTipo('SEGUNDA') | number:'1.0-0' }}</div>
                    <div class="text-xs text-secondary">kg</div>
                </div>

                <!-- ORILLAS -->
                <div class="bg-card shadow-sm rounded-xl p-4 border-l-4 border-teal-500">
                    <div class="flex items-center justify-between mb-1">
                        <div class="text-sm font-medium text-secondary">Orillas</div>
                        <mat-icon class="text-teal-500 icon-size-5"
                            [svgIcon]="'heroicons_solid:arrows-pointing-out'"></mat-icon>
                    </div>
                    <div class="text-2xl font-bold">{{ calcularPorTipo('ORILLAS') | number:'1.0-0' }}</div>
                    <div class="text-xs text-secondary">kg</div>
                </div>
            </div>

            <!-- Segunda fila: 3 cards -->
            <div class="grid grid-cols-3 gap-3">
                <!-- RETAZO -->
                <div class="bg-card shadow-sm rounded-xl p-4 border-l-4 border-amber-500">
                    <div class="flex items-center justify-between mb-1">
                        <div class="text-sm font-medium text-secondary">Retazo</div>
                        <mat-icon class="text-amber-500 icon-size-5"
                            [svgIcon]="'heroicons_solid:scissors'"></mat-icon>
                    </div>
                    <div class="text-2xl font-bold">{{ calcularPorTipo('RETAZO') | number:'1.0-0' }}</div>
                    <div class="text-xs text-secondary">kg</div>
                </div>

                <!-- MUESTRAS -->
                <div class="bg-card shadow-sm rounded-xl p-4 border-l-4 border-purple-500">
                    <div class="flex items-center justify-between mb-1">
                        <div class="text-sm font-medium text-secondary">Muestras</div>
                        <mat-icon class="text-purple-500 icon-size-5"
                            [svgIcon]="'heroicons_solid:beaker'"></mat-icon>
                    </div>
                    <div class="text-2xl font-bold">{{ calcularPorTipo('MUESTRAS') | number:'1.0-0' }}</div>
                    <div class="text-xs text-secondary">kg</div>
                </div>

                <!-- TOTAL GENERAL -->
                <div class="bg-gradient-to-br from-cyan-500 to-cyan-600 text-white shadow-lg rounded-xl p-4">
                    <div class="flex items-center justify-between mb-1">
                        <div class="text-sm font-semibold">Total General</div>
                        <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:calculator'"></mat-icon>
                    </div>
                    <div class="text-3xl font-bold">{{ calcularTotalEmbarques() | number:'1.0-0' }}</div>
                    <div class="text-xs opacity-90">kilogramos totales</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filtro adicional por tipo (solo desktop) -->
    <div class="hidden md:block px-4 md:px-8 mb-4">
        <mat-form-field class="fuse-mat-dense fuse-mat-rounded w-64">
            <mat-icon matPrefix [svgIcon]="'heroicons_solid:funnel'"></mat-icon>
            <mat-select [formControl]="tipoEmbarqueControl" placeholder="Filtrar por tipo">
                <mat-option [value]="''">Todos los tipos</mat-option>
                <mat-option *ngFor="let tipo of tiposEmbarqueUnicos" [value]="tipo">{{ tipo }}</mat-option>
            </mat-select>
        </mat-form-field>
    </div>

    <!-- Tabla de datos -->
    <div class="mt-6 overflow-x-auto px-4 md:px-8">
        <div *ngIf="isLoadingEmbarques" class="p-8 text-center">
            <mat-spinner diameter="40" class="mx-auto"></mat-spinner>
            <p class="mt-4 text-secondary">Cargando datos de embarques...</p>
        </div>

        <table *ngIf="!isLoadingEmbarques && datosEmbarquesFiltrados.length > 0"
            class="w-full bg-card shadow-sm rounded-2xl overflow-hidden">
            <thead class="bg-gray-50 dark:bg-gray-800">
                <tr>
                    <th class="px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider">
                        Tipo
                    </th>
                    <th class="px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider">
                        Artículo
                    </th>
                    <th class="px-6 py-4 text-right text-xs font-semibold uppercase tracking-wider">
                        Cantidad (kg)
                    </th>
                </tr>
            </thead>
            <tbody class="divide-y">
                <tr *ngFor="let item of datosEmbarquesFiltrados"
                    class="hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-3">
                            <span class="px-3 py-1 rounded-full text-xs font-semibold"
                                [ngClass]="{
                                    'bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300': item.TIPO === 'PRIMERA',
                                    'bg-indigo-100 text-indigo-700 dark:bg-indigo-900 dark:text-indigo-300': item.TIPO === 'PREFERIDA',
                                    'bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300': item.TIPO === 'SEGUNDA',
                                    'bg-teal-100 text-teal-700 dark:bg-teal-900 dark:text-teal-300': item.TIPO === 'ORILLAS',
                                    'bg-amber-100 text-amber-700 dark:bg-amber-900 dark:text-amber-300': item.TIPO === 'RETAZO',
                                    'bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300': item.TIPO === 'MUESTRAS',
                                    'bg-gray-100 text-gray-700 dark:bg-gray-900 dark:text-gray-300': item.TIPO === 'SIN CLASIFICAR'
                                }">
                                {{ item.TIPO }}
                            </span>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-3">
                            <mat-icon class="icon-size-5 text-cyan-500"
                                [svgIcon]="'heroicons_solid:cube'"></mat-icon>
                            <span class="font-medium">{{ item.ARTICULO }}</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 text-right">
                        <span class="font-semibold text-cyan-600 dark:text-cyan-400 text-lg">
                            {{ item.CANTIDAD | number:'1.2-2' }}
                        </span>
                    </td>
                </tr>
            </tbody>
            <tfoot class="bg-gray-50 dark:bg-gray-800 font-bold border-t-2">
                <tr>
                    <td colspan="2" class="px-6 py-4 uppercase text-sm">Total:</td>
                    <td class="px-6 py-4 text-right">
                        <span class="text-lg text-cyan-600 dark:text-cyan-400">
                            {{ calcularTotalEmbarques() | number:'1.2-2' }}
                        </span>
                    </td>
                </tr>
            </tfoot>
        </table>

        <div *ngIf="!isLoadingEmbarques && datosEmbarquesFiltrados.length === 0"
            class="p-8 text-center text-secondary">
            <mat-icon class="icon-size-16 mb-4" [svgIcon]="'heroicons_outline:truck'"></mat-icon>
            <p class="text-lg font-medium mb-2">Sin datos de embarques</p>
            <p class="text-sm">No hay registros de producción entregada a embarques</p>
        </div>
    </div>
</mat-tab>

                    </mat-tab-group>
                </div>
            </ng-container>
        </div>
    </div>
</div>