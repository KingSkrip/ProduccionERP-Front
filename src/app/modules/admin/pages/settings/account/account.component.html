<div class="w-full max-w-3xl">
    <!-- Formulario -->
    <form [formGroup]="accountForm">
        <!-- Sección -->
        <div class="w-full">
            <div class="text-xl">Perfil</div>
            <div class="text-secondary">
                La siguiente información se muestra públicamente, ¡ten cuidado!
            </div>
        </div>

        <!-- Foto de perfil arriba -->
        <div class="mb-10 mt-6 flex flex-col items-center">
            <!-- Contenedor de la imagen con hover effect -->
            <div class="group relative">
                <!-- Loader mientras carga la imagen -->
                <div
                    *ngIf="isLoadingImage"
                    class="absolute inset-0 z-10 flex items-center justify-center rounded-full bg-black bg-opacity-60"
                >
                    <mat-spinner
                        [diameter]="36"
                        [color]="'accent'"
                    ></mat-spinner>
                </div>

                <!-- Imagen de perfil -->
                <img
                    [src]="preview"
                    alt="Foto de perfil"
                    class="h-40 w-40 rounded-full border-4 border-gray-200 object-cover shadow-xl transition-all duration-300 group-hover:border-primary group-hover:shadow-2xl"
                    [class.opacity-40]="isLoadingImage"
                />

                <!-- Overlay oscuro al hacer hover -->
                <div
                    *ngIf="!isLoadingImage"
                    class="absolute inset-0 flex cursor-pointer items-center justify-center rounded-full bg-black bg-opacity-0 transition-all duration-300 group-hover:bg-opacity-40"
                >
                    <div
                        class="flex flex-col items-center gap-1 opacity-0 transition-opacity duration-300 group-hover:opacity-100"
                    >
                        <mat-icon
                            class="text-white"
                            [svgIcon]="'heroicons_outline:camera'"
                        ></mat-icon>
                        <span class="text-xs font-medium text-white"
                            >Editar</span
                        >
                    </div>
                </div>

                <!-- Input file invisible sobre la imagen -->
                <input
                    type="file"
                    #fileInput
                    accept="image/*"
                    (change)="onFileSelected($event)"
                    class="absolute inset-0 cursor-pointer opacity-0"
                    [disabled]="isLoadingImage"
                />
            </div>

            <!-- Botón de cambiar foto solo en móviles -->
            <button
                type="button"
                class="mt-6 block flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-5 py-2 text-sm font-medium text-gray-700 shadow-sm transition-all duration-200 hover:border-gray-400 hover:bg-gray-50 hover:shadow disabled:cursor-not-allowed disabled:opacity-50 md:hidden"
                (click)="fileInput.click()"
                [disabled]="isLoadingImage"
            >
                <mat-icon
                    class="text-gray-600 icon-size-5"
                    [svgIcon]="'heroicons_outline:camera'"
                ></mat-icon>
                {{ isLoadingImage ? 'Cargando imagen...' : 'Cambiar foto' }}
            </button>

            <!-- Texto de ayuda -->
            <p class="mt-3 text-xs text-gray-500">
                Formatos: JPG, PNG o GIF · Tamaño máximo: 2MB
            </p>
        </div>

        <div class="mt-8 grid w-full gap-6 sm:grid-cols-2">
            <!-- Nombre -->
            <div class="w-full">
                <mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
                    <mat-label>Nombre de usuario</mat-label>
                    <mat-icon
                        class="icon-size-5"
                        [svgIcon]="'heroicons_solid:user'"
                        matPrefix
                    ></mat-icon>
                    <input
                        [formControlName]="'username'"
                        maxlength="18"
                        matInput
                    />
                </mat-form-field>
            </div>

            <!-- Departamento -->
            <div class="w-full">
                <mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
                    <mat-label>Departamento</mat-label>
                    <mat-icon
                        class="icon-size-5"
                        [svgIcon]="'heroicons_solid:building-office'"
                        matPrefix
                    ></mat-icon>
                    <input
                        [formControlName]="'departamento'"
                        maxlength="25"
                        matInput
                    />
                </mat-form-field>
            </div>
        </div>

        <!-- Divisor -->
        <div class="my-10 border-t"></div>

        <!-- Sección -->
        <div class="w-full">
            <div class="text-xl">Información personal</div>
            <div class="text-secondary">
                Detalles de contacto en caso de que queramos comunicarnos
                contigo. Esta información se mantendrá privada.
            </div>
        </div>

        <div class="mt-8 grid w-full gap-6 sm:grid-cols-4">
            <!-- Nombre -->
            <div class="sm:col-span-4">
                <mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
                    <mat-label>Nombre</mat-label>
                    <mat-icon
                        class="icon-size-5"
                        [svgIcon]="'heroicons_solid:user'"
                        matPrefix
                    ></mat-icon>
                    <input [formControlName]="'name'" maxlength="35" matInput />
                </mat-form-field>
            </div>

            <!-- Email -->
            <div class="sm:col-span-4">
                <mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
                    <mat-label>Correo electrónico</mat-label>
                    <mat-icon
                        class="icon-size-5"
                        [svgIcon]="'heroicons_solid:envelope'"
                        matPrefix
                    ></mat-icon>
                    <input
                        [formControlName]="'email'"
                        maxlength="40"
                        matInput
                    />
                </mat-form-field>
            </div>
        </div>

        <!-- Divisor -->
        <div class="mb-10 mt-11 border-t"></div>

        <!-- Acciones -->
        <div class="flex items-center justify-end">
            <button mat-stroked-button type="button">Cancelar</button>

            <button
                class="ml-4"
                mat-flat-button
                type="button"
                [color]="'primary'"
                (click)="guardarPerfil()"
                [disabled]="isLoadingForm"
            >
                Guardar
            </button>
        </div>
    </form>
</div>
