<div class="absolute inset-0 flex min-w-0 flex-col overflow-hidden bg-gray-50 dark:bg-gray-900">
  <!-- ===== HEADER MÓVIL (como estaba) ===== -->
  <div class="relative bg-gray-50 md:hidden dark:bg-gray-900">
    <div class="relative px-6 py-2">
      <div class="flex items-start gap-4">
        <div
          class="flex h-14 w-14 items-center justify-center rounded-2xl bg-primary shadow-lg ring-1 ring-white/20 backdrop-blur-sm"
        >
          <mat-icon
            class="text-white icon-size-7"
            [svgIcon]="'heroicons_outline:chart-bar'"
          ></mat-icon>
        </div>
        <div class="flex-1">
          <h1 class="text-2xl font-bold tracking-tight text-black dark:text-white">
            Reportes de Producción
          </h1>
          <p class="mt-1.5 text-sm text-black dark:text-white">
            Analiza la producción por departamento y proceso
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== HEADER + FILTROS COMPRIMIDO PC ===== -->
  <div
    class="hidden items-center gap-4 border-gray-200 bg-gray-50 px-6 py-2 md:flex dark:border-gray-700 dark:bg-gray-900"
  >
    <!-- Ícono + Títulos -->
    <div class="flex flex-shrink-0 items-center gap-2.5">
      <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-primary shadow-sm">
        <mat-icon
          class="text-white icon-size-6"
          [svgIcon]="'heroicons_outline:chart-bar'"
        ></mat-icon>
      </div>
      <div class="leading-tight">
        <p class="whitespace-nowrap text-xl font-bold text-gray-900 dark:text-white">
          Reportes de Producción
        </p>
        <p class="whitespace-nowrap text-[12px] text-gray-400">
          Analiza la producción por departamento y proceso
        </p>
      </div>
    </div>
    <!-- Divisor -->
    <div class="h-8 w-px flex-shrink-0 bg-gray-200 dark:bg-gray-700"></div>
    <!-- Buscador -->
    <mat-form-field
      class="fuse-mat-dense fuse-mat-rounded flex-1"
      appearance="outline"
      [subscriptSizing]="'dynamic'"
    >
      <mat-icon
        matPrefix
        class="text-gray-400 icon-size-4"
        [svgIcon]="'heroicons_outline:magnifying-glass'"
      ></mat-icon>
      <input
        matInput
        [formControl]="searchControl"
        [autocomplete]="'off'"
        placeholder="Buscar..."
      />
    </mat-form-field>
    <!-- Botón Filtros -->
    <div class="relative flex-shrink-0">
      <button
        mat-flat-button
        color="primary"
        class="h-9 rounded-xl px-4"
        (click)="togglePanelFiltrosPc()"
      >
        <span class="flex items-center gap-2">
          <mat-icon
            class="text-white icon-size-4"
            [svgIcon]="'heroicons_outline:adjustments-horizontal'"
          ></mat-icon>
          <span class="text-sm font-medium">Filtros</span>
          <span
            *ngIf="filtrosActivosCount() > 0"
            class="rounded-full bg-white/30 px-1.5 py-0.5 text-[10px] font-bold leading-none"
          >
            {{ filtrosActivosCount() }}
          </span>
          <mat-icon
            class="text-white transition-transform icon-size-3.5"
            [class.rotate-180]="mostrarPanelFiltrosPc"
            [svgIcon]="'heroicons_outline:chevron-down'"
          ></mat-icon>
        </span>
      </button>
      <!-- Panel desplegable -->
      <div
        *ngIf="mostrarPanelFiltrosPc"
        class="absolute right-0 top-full z-50 mt-2 flex max-h-[calc(70vh-70px)] min-h-0 w-[480px] flex-col rounded-2xl border border-gray-200 bg-white shadow-2xl dark:border-gray-700 dark:bg-gray-800"
        [@slideDown]
      >
        <!-- Header del panel -->
        <div class="flex-shrink-0 border-b p-4 dark:border-gray-700">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
              <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-primary/10">
                <mat-icon
                  class="text-primary icon-size-4"
                  [svgIcon]="'heroicons_outline:funnel'"
                ></mat-icon>
              </div>
              <h3 class="text-sm font-semibold">Filtros Avanzados</h3>
            </div>
            <button mat-icon-button class="h-8 w-8" (click)="togglePanelFiltrosPc()">
              <mat-icon class="icon-size-4" [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
            </button>
          </div>
        </div>
        <!-- Contenido scrolleable -->
        <div class="min-h-0 flex-1 space-y-5 overflow-y-auto p-5">
          <!-- SECCIÓN: RANGO DE FECHA -->
          <div>
            <div class="mb-3 flex items-center gap-2">
              <mat-icon
                class="text-primary icon-size-5"
                [svgIcon]="'heroicons_outline:calendar-days'"
              ></mat-icon>
              <h4 class="font-semibold">Rango de Fecha</h4>
            </div>
            <div class="space-y-2">
              <button
                mat-button
                class="flex h-11 w-full items-center justify-center rounded-xl px-4 text-left transition-all"
                [ngClass]="
                  rangoFechaSeleccionado === 'todos'
                    ? 'bg-primary text-white shadow-md'
                    : 'hover:bg-gray-50 dark:hover:bg-gray-700'
                "
                (click)="seleccionarRangoFecha('todos')"
              >
                <mat-icon
                  class="mr-3 icon-size-5"
                  [ngClass]="rangoFechaSeleccionado === 'todos' ? 'text-white' : 'text-gray-400'"
                  [svgIcon]="'heroicons_outline:queue-list'"
                ></mat-icon>
                <span class="flex-1 font-medium">Todos los registros</span>
                <mat-icon
                  *ngIf="rangoFechaSeleccionado === 'todos'"
                  class="text-white icon-size-5"
                  [svgIcon]="'heroicons_outline:check'"
                ></mat-icon>
              </button>
              <div class="grid grid-cols-3 items-center gap-3">
                <button
                  mat-button
                  class="flex h-10 items-center justify-center rounded-xl px-3 transition-all"
                  [ngClass]="
                    rangoFechaSeleccionado === 'hoy'
                      ? 'bg-primary text-white shadow-md'
                      : 'hover:bg-gray-50 dark:hover:bg-gray-700'
                  "
                  (click)="seleccionarRangoFecha('hoy')"
                >
                  <mat-icon
                    class="mr-2 icon-size-4"
                    [ngClass]="rangoFechaSeleccionado === 'hoy' ? 'text-white' : 'text-gray-400'"
                    [svgIcon]="'heroicons_outline:sun'"
                  ></mat-icon>
                  <span class="font-medium">Hoy</span>
                </button>
                <button
                  mat-button
                  class="flex h-10 items-center justify-center rounded-xl px-3 transition-all"
                  [ngClass]="
                    rangoFechaSeleccionado === 'ayer'
                      ? 'bg-primary text-white shadow-md'
                      : 'hover:bg-gray-50 dark:hover:bg-gray-700'
                  "
                  (click)="seleccionarRangoFecha('ayer')"
                >
                  <mat-icon
                    class="mr-2 icon-size-4"
                    [ngClass]="rangoFechaSeleccionado === 'ayer' ? 'text-white' : 'text-gray-400'"
                    [svgIcon]="'heroicons_outline:moon'"
                  ></mat-icon>
                  <span class="font-medium">Ayer</span>
                </button>
                <button
                  mat-button
                  class="flex h-10 items-center justify-center rounded-xl px-3 transition-all"
                  [ngClass]="
                    rangoFechaSeleccionado === 'mes_actual'
                      ? 'bg-primary text-white shadow-md'
                      : 'hover:bg-gray-50 dark:hover:bg-gray-700'
                  "
                  (click)="seleccionarRangoFecha('mes_actual')"
                >
                  <mat-icon
                    class="mr-2 icon-size-4"
                    [ngClass]="
                      rangoFechaSeleccionado === 'mes_actual' ? 'text-white' : 'text-gray-400'
                    "
                    [svgIcon]="'heroicons_outline:calendar-days'"
                  ></mat-icon>
                  <span class="font-medium">Este mes</span>
                </button>
                <button
                  mat-button
                  class="flex h-10 items-center justify-center rounded-xl px-3 transition-all"
                  [ngClass]="
                    rangoFechaSeleccionado === 'mes_anterior'
                      ? 'bg-primary text-white shadow-md'
                      : 'hover:bg-gray-50 dark:hover:bg-gray-700'
                  "
                  (click)="seleccionarRangoFecha('mes_anterior')"
                >
                  <mat-icon
                    class="mr-2 icon-size-4"
                    [ngClass]="
                      rangoFechaSeleccionado === 'mes_anterior' ? 'text-white' : 'text-gray-400'
                    "
                    [svgIcon]="'heroicons_outline:arrow-uturn-left'"
                  ></mat-icon>
                  <span class="font-medium">Mes ant.</span>
                </button>
                <button
                  mat-stroked-button
                  class="flex h-10 items-center rounded-xl border-2 transition-all"
                  [ngClass]="
                    rangoFechaSeleccionado === 'fecha_especifica'
                      ? 'border-primary bg-primary/5'
                      : ''
                  "
                  (click)="seleccionarRangoFecha('fecha_especifica')"
                >
                  <mat-icon
                    class="mr-2 icon-size-4"
                    [ngClass]="
                      rangoFechaSeleccionado === 'fecha_especifica'
                        ? 'text-primary'
                        : 'text-gray-400'
                    "
                    [svgIcon]="'heroicons_outline:calendar'"
                  ></mat-icon>
                  <span
                    class="font-medium"
                    [ngClass]="rangoFechaSeleccionado === 'fecha_especifica' ? 'text-primary' : ''"
                    >Fecha específica</span
                  >
                </button>
                <button
                  mat-stroked-button
                  class="flex h-10 items-center rounded-xl border-2 transition-all"
                  [ngClass]="
                    rangoFechaSeleccionado === 'periodo' ? 'border-primary bg-primary/5' : ''
                  "
                  (click)="seleccionarRangoFecha('periodo')"
                >
                  <mat-icon
                    class="mr-2 icon-size-4"
                    [ngClass]="
                      rangoFechaSeleccionado === 'periodo' ? 'text-primary' : 'text-gray-400'
                    "
                    [svgIcon]="'heroicons_outline:arrow-trending-up'"
                  ></mat-icon>
                  <span
                    class="font-medium"
                    [ngClass]="rangoFechaSeleccionado === 'periodo' ? 'text-primary' : ''"
                    >Periodo</span
                  >
                </button>
              </div>
            </div>
            <div
              *ngIf="rangoFechaSeleccionado === 'fecha_especifica'"
              class="mt-4 space-y-3 rounded-xl bg-gray-50 p-4 dark:bg-gray-900/50"
            >
              <h5 class="text-sm font-semibold text-gray-600 dark:text-gray-400">
                Selecciona una fecha
              </h5>
              <mat-form-field class="w-full" appearance="outline">
                <input
                  matInput
                  readonly
                  [matDatepicker]="pickerPcUnica"
                  [formControl]="fechaInicioControl"
                />
                <mat-datepicker-toggle matIconSuffix [for]="pickerPcUnica"></mat-datepicker-toggle>
                <mat-datepicker #pickerPcUnica></mat-datepicker>
              </mat-form-field>
            </div>
            <div
              *ngIf="rangoFechaSeleccionado === 'periodo'"
              class="mt-4 space-y-3 rounded-xl bg-gray-50 p-4 dark:bg-gray-900/50"
            >
              <h5 class="text-sm font-semibold text-gray-600 dark:text-gray-400">
                Rango personalizado
              </h5>
              <mat-form-field class="w-full" appearance="outline">
                <mat-label>Fecha Desde</mat-label>
                <input
                  matInput
                  readonly
                  [matDatepicker]="pickerPcInicio"
                  [formControl]="fechaInicioControl"
                />
                <mat-datepicker-toggle matIconSuffix [for]="pickerPcInicio"></mat-datepicker-toggle>
                <mat-datepicker #pickerPcInicio></mat-datepicker>
              </mat-form-field>
              <mat-form-field class="w-full" appearance="outline">
                <mat-label>Fecha Hasta</mat-label>
                <input
                  matInput
                  readonly
                  [matDatepicker]="pickerPcFin"
                  [formControl]="fechaFinControl"
                />
                <mat-datepicker-toggle matIconSuffix [for]="pickerPcFin"></mat-datepicker-toggle>
                <mat-datepicker #pickerPcFin></mat-datepicker>
              </mat-form-field>
            </div>
          </div>
          <!-- SECCIÓN: DEPARTAMENTO -->
          <div class="border-t pt-3">
            <div class="mb-3 flex items-center gap-2">
              <mat-icon
                class="text-primary icon-size-5"
                [svgIcon]="'heroicons_outline:building-office-2'"
              ></mat-icon>
              <h4 class="font-semibold">Departamento</h4>
            </div>
            <mat-form-field class="w-full" appearance="outline">
              <mat-select [formControl]="deptoControl" placeholder="Todos los departamentos">
                <mat-option [value]="''"
                  ><span class="font-medium">Todos los departamentos</span></mat-option
                >
                <mat-option *ngFor="let depto of departamentosUnicos" [value]="depto">{{
                  depto
                }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
        <!-- Footer -->
        <div class="flex-shrink-0 border-t bg-gray-50 p-4 dark:bg-gray-900/50">
          <div class="flex gap-3">
            <button
              mat-button
              class="h-11 flex-1 rounded-xl text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20"
              (click)="limpiarTodosFiltros()"
            >
              <mat-icon
                class="mr-2 icon-size-5"
                [svgIcon]="'heroicons_outline:x-circle'"
              ></mat-icon>
              Limpiar
            </button>
            <button
              mat-flat-button
              color="primary"
              class="h-11 flex-1 rounded-xl shadow-lg"
              (click)="aplicarFiltrosPc(); togglePanelFiltrosPc()"
            >
              <mat-icon class="mr-2 icon-size-5" [svgIcon]="'heroicons_outline:check'"></mat-icon>
              Aplicar filtros
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Overlay PC -->
    <div
      *ngIf="mostrarPanelFiltrosPc"
      class="fixed inset-0 z-40"
      (click)="togglePanelFiltrosPc()"
    ></div>
  </div>

  <!-- Chip filtros activos PC -->
  <div
    *ngIf="filtrosActivosCount() > 0"
    class="hidden items-center gap-2 border-b border-blue-100 bg-blue-50 px-6 py-1.5 text-xs md:flex dark:border-blue-800 dark:bg-blue-900/20"
  >
    <mat-icon class="text-blue-500 icon-size-3.5" [svgIcon]="'heroicons_outline:funnel'"></mat-icon>
    <span class="text-blue-600 dark:text-blue-400">
      <span class="font-semibold">{{ filtrosActivosCount() }}</span> filtro(s) activo(s)
    </span>
    <button
      mat-button
      class="ml-1 h-6 rounded-md bg-red-500/20 px-2 text-xs text-red-600"
      (click)="limpiarTodosFiltros()"
    >
      Limpiar todos
    </button>
  </div>

  <!-- ===== BARRA DE FILTROS MÓVIL (STICKY) ===== -->
  <div class="sticky top-0 bg-gray-50 md:hidden dark:bg-gray-900">
    <div class="flex items-center gap-2 px-3">
      <mat-form-field
        class="fuse-mat-dense flex-1"
        appearance="outline"
        [subscriptSizing]="'dynamic'"
      >
        <mat-icon
          matPrefix
          class="text-gray-400 icon-size-5"
          [svgIcon]="'heroicons_outline:magnifying-glass'"
        ></mat-icon>
        <input
          matInput
          [formControl]="searchControl"
          [autocomplete]="'off'"
          placeholder="Buscar..."
        />
      </mat-form-field>
      <button
        mat-mini-fab
        color="primary"
        class="relative shadow-md"
        (click)="togglePanelFiltros()"
        [matBadge]="filtrosActivosCount()"
        matBadgeSize="small"
        matBadgeColor="accent"
        [matBadgeHidden]="filtrosActivosCount() === 0"
      >
        <mat-icon [svgIcon]="'heroicons_outline:adjustments-horizontal'"></mat-icon>
      </button>
    </div>
  </div>

  <!-- Overlay oscuro móvil -->
  <div
    *ngIf="mostrarPanelFiltros"
    class="fixed inset-0 z-40 bg-black/60 backdrop-blur-sm md:hidden"
    (click)="togglePanelFiltros()"
    [@fadeIn]
  ></div>

  <!-- Panel de filtros móvil - desde abajo -->
  <div
    *ngIf="mostrarPanelFiltros"
    class="bg-card fixed bottom-10 left-0 right-0 z-50 flex max-h-[85vh] flex-col rounded-t-3xl shadow-2xl md:hidden"
  >
    <!-- Header - NO crece ni se encoge -->
    <div class="flex flex-shrink-0 items-center justify-between border-b p-4">
      <h2 class="text-lg font-semibold">Filtros Avanzados</h2>
      <button mat-icon-button (click)="togglePanelFiltros()">
        <mat-icon [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
      </button>
    </div>

    <div class="min-h-0 flex-1 space-y-5 overflow-y-auto p-4">
      <!-- RANGO DE FECHA -->
      <div>
        <div class="mb-3 flex items-center gap-2">
          <mat-icon
            class="text-primary icon-size-5"
            [svgIcon]="'heroicons_outline:calendar-days'"
          ></mat-icon>
          <h3 class="text-sm font-medium">Rango de Fecha</h3>
        </div>
        <div class="grid grid-cols-2 gap-2">
          <button
            mat-stroked-button
            class="h-10 rounded-full text-sm"
            [ngClass]="{
              '!border-primary !bg-primary !text-white': rangoFechaSeleccionado === 'todos',
            }"
            (click)="seleccionarRangoFecha('todos')"
          >
            Todos
          </button>
          <button
            mat-stroked-button
            class="h-10 rounded-full text-sm"
            [ngClass]="{
              '!border-primary !bg-primary !text-white': rangoFechaSeleccionado === 'hoy',
            }"
            (click)="seleccionarRangoFecha('hoy')"
          >
            Hoy
          </button>
          <button
            mat-stroked-button
            class="h-10 rounded-full text-sm"
            [ngClass]="{
              '!border-primary !bg-primary !text-white': rangoFechaSeleccionado === 'ayer',
            }"
            (click)="seleccionarRangoFecha('ayer')"
          >
            Ayer
          </button>
          <button
            mat-stroked-button
            class="h-10 rounded-full text-sm"
            [ngClass]="{
              '!border-primary !bg-primary !text-white': rangoFechaSeleccionado === 'mes_actual',
            }"
            (click)="seleccionarRangoFecha('mes_actual')"
          >
            Este mes
          </button>
          <button
            mat-stroked-button
            class="h-10 rounded-full text-sm"
            [ngClass]="{
              '!border-primary !bg-primary !text-white': rangoFechaSeleccionado === 'mes_anterior',
            }"
            (click)="seleccionarRangoFecha('mes_anterior')"
          >
            Mes ant.
          </button>
          <button
            mat-stroked-button
            class="h-10 rounded-full text-sm"
            [ngClass]="{
              '!border-primary !bg-primary !text-white':
                rangoFechaSeleccionado === 'fecha_especifica',
            }"
            (click)="seleccionarRangoFecha('fecha_especifica')"
          >
            Fecha específica
          </button>
          <button
            mat-stroked-button
            class="col-span-2 h-10 rounded-full text-sm"
            [ngClass]="{
              '!border-primary !bg-primary !text-white': rangoFechaSeleccionado === 'periodo',
            }"
            (click)="seleccionarRangoFecha('periodo')"
          >
            Periodo personalizado
          </button>
        </div>
        <div
          *ngIf="rangoFechaSeleccionado === 'fecha_especifica'"
          class="mt-4 space-y-3 rounded-xl bg-primary/5 p-4"
        >
          <h4 class="text-sm font-semibold">Selecciona una fecha</h4>
          <mat-form-field class="w-full" appearance="outline">
            <input matInput [matDatepicker]="pickerMovilUnica" [formControl]="fechaInicioControl" />
            <mat-datepicker-toggle matIconSuffix [for]="pickerMovilUnica"></mat-datepicker-toggle>
            <mat-datepicker #pickerMovilUnica touchUi></mat-datepicker>
          </mat-form-field>
        </div>
        <div
          *ngIf="rangoFechaSeleccionado === 'periodo'"
          class="mt-4 space-y-3 rounded-xl bg-primary/5 p-4"
        >
          <h4 class="text-sm font-semibold">Rango personalizado</h4>
          <mat-form-field class="w-full" appearance="outline">
            <mat-label>Fecha Desde</mat-label>
            <input
              matInput
              [matDatepicker]="pickerMovilInicio"
              [formControl]="fechaInicioControl"
            />
            <mat-datepicker-toggle matIconSuffix [for]="pickerMovilInicio"></mat-datepicker-toggle>
            <mat-datepicker #pickerMovilInicio touchUi></mat-datepicker>
          </mat-form-field>
          <mat-form-field class="w-full" appearance="outline">
            <mat-label>Fecha Hasta</mat-label>
            <input matInput [matDatepicker]="pickerMovilFin" [formControl]="fechaFinControl" />
            <mat-datepicker-toggle matIconSuffix [for]="pickerMovilFin"></mat-datepicker-toggle>
            <mat-datepicker #pickerMovilFin touchUi></mat-datepicker>
          </mat-form-field>
        </div>
      </div>
      <!-- DEPARTAMENTO -->
      <div>
        <div class="mb-3 flex items-center gap-2">
          <mat-icon
            class="text-primary icon-size-5"
            [svgIcon]="'heroicons_outline:building-office-2'"
          ></mat-icon>
          <h3 class="text-sm font-medium">Departamento</h3>
        </div>
        <mat-form-field class="w-full" appearance="outline">
          <mat-select [formControl]="deptoControl" placeholder="Todos los departamentos">
            <mat-option [value]="''">Todos los departamentos</mat-option>
            <mat-option *ngFor="let depto of departamentosUnicos" [value]="depto">{{
              depto
            }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <div class="bg-card flex-shrink-0 border-t p-4">
      <div class="flex gap-2">
        <button mat-stroked-button class="h-11 flex-1 rounded-full" (click)="limpiarTodosFiltros()">
          Limpiar
        </button>
        <button
          mat-flat-button
          color="primary"
          class="h-11 flex-1 rounded-full"
          (click)="aplicarFiltrosMovil()"
        >
          Aplicar
        </button>
      </div>
    </div>
  </div>

  <!-- ===== CONTENIDO PRINCIPAL ===== -->
  <div class="flex flex-auto overflow-hidden">
    <div class="flex flex-auto flex-col overflow-y-auto">
      <div class="w-full pb-6 md:px-2">
        <router-outlet></router-outlet>
      </div>
      <ng-container *ngIf="!isLoading && datosFiltrados.length === 0">
        <div class="flex flex-auto flex-col items-center justify-center p-8">
          <div class="relative">
            <div
              class="mb-6 flex h-32 w-32 items-center justify-center rounded-3xl bg-gradient-to-br from-primary/10 to-primary/5 shadow-inner ring-1 ring-primary/10"
            >
              <mat-icon
                class="text-primary/40 icon-size-20"
                [svgIcon]="'heroicons_outline:inbox'"
              ></mat-icon>
            </div>
            <div
              class="absolute -right-2 -top-2 h-8 w-8 animate-pulse rounded-full bg-primary/20"
            ></div>
          </div>
          <h3 class="mb-2 text-2xl font-bold tracking-tight">No hay datos disponibles</h3>
          <p class="max-w-md text-center text-gray-500 dark:text-gray-400">
            No se encontraron registros con los filtros seleccionados. Intenta ajustar tus criterios
            de búsqueda.
          </p>
          <button mat-stroked-button class="mt-6 rounded-xl" (click)="limpiarTodosFiltros()">
            <mat-icon
              class="mr-2 icon-size-5"
              [svgIcon]="'heroicons_outline:arrow-path'"
            ></mat-icon>
            Restablecer filtros
          </button>
        </div>
      </ng-container>
      <ng-container *ngIf="!isLoading && datosFiltrados.length > 0">
        <div class="w-full pb-2 md:px-2"></div>
      </ng-container>
    </div>
  </div>
</div>
